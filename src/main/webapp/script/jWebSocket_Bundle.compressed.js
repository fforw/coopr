if(window.MozWebSocket){window.WebSocket=window.MozWebSocket}var jws={VERSION:"1.0b6 (nightly build 20407)",NS_BASE:"org.jwebsocket",NS_SYSTEM:"org.jwebsocket.plugins.system",MSG_WS_NOT_SUPPORTED:"Unfortunately your browser does neither natively support WebSockets\nnor you have the Adobe Flash-PlugIn 10+ installed.\nPlease download the last recent Adobe Flash Player at http://get.adobe.com/flashplayer.",CUR_TOKEN_ID:0,JWS_SERVER_SCHEMA:"ws",JWS_SERVER_SSL_SCHEMA:"wss",JWS_SERVER_HOST:(self.location.hostname?self.location.hostname:"127.0.0.1"),JWS_SERVER_PORT:8787,JWS_SERVER_SSL_PORT:9797,JWS_SERVER_CONTEXT:"/jWebSocket",JWS_SERVER_SERVLET:"/jWebSocket",JWS_SERVER_URL:"ws://"+(self.location.hostname?self.location.hostname:"127.0.0.1")+":8787/jWebSocket/jWebSocket",CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,RECONNECTING:1000,OPEN_TIMED_OUT:1001,RO_OFF:{autoReconnect:false,reconnectDelay:-1,reconnectTimeout:-1,queueItemLimit:-1,queueSizeLimit:-1},RO_ON:{autoReconnect:true,reconnectDelay:2000,reconnectTimeout:30000,queueItemLimit:1000,queueSizeLimit:1024*1024*10},WS_SUBPROT_JSON:"org.jwebsocket.json",WS_SUBPROT_XML:"org.jwebsocket.xml",WS_SUBPROT_CSV:"org.jwebsocket.csv",WS_SUBPROT_CUSTOM:"org.jwebsocket.text",WS_SUBPROT_TEXT:"org.jwebsocket.text",WS_SUBPROT_BINARY:"org.jwebsocket.binary",SCOPE_PRIVATE:"private",SCOPE_PUBLIC:"public",DEF_RESP_TIMEOUT:30000,BT_UNKNOWN:0,BT_FIREFOX:1,BT_NETSCAPE:2,BT_OPERA:3,BT_IEXPLORER:4,BT_SAFARI:5,BT_CHROME:6,BROWSER_NAMES:["Unknown","Firefox","Netscape","Opera","Internet Explorer","Safari","Chrome"],GUEST_USER_LOGINNAME:"guest",GUEST_USER_PASSWORD:"guest",DEMO_ROOT_LOGINNAME:"root",DEMO_ROOT_PASSWORD:"root",$:function(a){return document.getElementById(a)},getServerURL:function(b,a,f,e,c){var d=b+"://"+a+(f?":"+f:"");if(e&&e.length>0){d+=e;if(c&&c.length>0){d+=c}}return d},getDefaultServerURL:function(){return(this.getServerURL(jws.JWS_SERVER_SCHEMA,jws.JWS_SERVER_HOST,jws.JWS_SERVER_PORT,jws.JWS_SERVER_CONTEXT,jws.JWS_SERVER_SERVLET))},getDefaultSSLServerURL:function(){return(this.getServerURL(jws.JWS_SERVER_SSL_SCHEMA,jws.JWS_SERVER_HOST,jws.JWS_SERVER_SSL_PORT,jws.JWS_SERVER_CONTEXT,jws.JWS_SERVER_SERVLET))},browserSupportsWebSockets:function(){return(window.WebSocket!==null&&window.WebSocket!==undefined)},browserSupportsNativeWebSockets:(function(){return(window.WebSocket!==null&&window.WebSocket!==undefined)})(),browserSupportsJSON:function(){return(window.JSON!==null&&window.JSON!==undefined)},browserSupportsNativeJSON:(function(){return(window.JSON!==null&&window.JSON!==undefined)})(),browserSupportsWebWorkers:(function(){return(window.Worker!==null&&window.Worker!==undefined)})(),runAsThread:function(d){if(!this.browserSupportsWebWorkers){return{code:-1,msg:"Browser does not (yet) support WebWorkers."}}if(!d){d={}}var f=null;var c=null;var a=jws.SCRIPT_PATH+"jwsWorker.js";var b=null;var g=[];if(d.OnMessage&&typeof d.OnMessage=="function"){f=d.OnMessage}if(d.OnError&&typeof d.OnError=="function"){c=d.OnError}if(d.file&&typeof d.file=="String"){a=d.file}if(d.method&&typeof d.method=="function"){b=d.method}if(d.args){g=d.args}var e=this;if(!jws.worker){jws.worker=new Worker(a);jws.worker.onmessage=function(h){if(f!=null){f.call(e,{data:h.data})}};jws.worker.onerror=function(h){if(c!=null){c.call(e,{message:h.message})}}}jws.worker.postMessage({method:b.toString(),args:g});return{code:0,msg:"ok",worker:jws.worker}},SCRIPT_PATH:(function(){var c=document.getElementsByTagName("script");for(var b=0,e=c.length;b<e;b++){var f=c[b];var d=f.src;if(!d){d=f.getAttribute("src")}if(d){var a=d.lastIndexOf("jWebSocket");if(a>0){return d.substr(0,a)}}}return null})(),isIE:(function(){var b=navigator.userAgent;var a=b.indexOf("MSIE");return(a>=0)})(),getBrowserName:function(){return this.fBrowserName},getBrowserVersion:function(){return this.fBrowserVerNo},getBrowserVersionString:function(){return this.fBrowserVerStr},isFirefox:function(){return this.fIsFirefox},isOpera:function(){return this.fIsOpera},isChrome:function(){return this.fIsChrome},isIExplorer:function(){return this.fIsIExplorer},isIE_LE6:function(){return(this.isIExplorer()&&this.getBrowserVersion()<7)},isIE_LE7:function(){return(this.isIExplorer()&&this.getBrowserVersion()<8)},isIE_GE8:function(){return(this.isIExplorer()&&this.getBrowserVersion()>=8)},isSafari:function(){return this.fIsSafari},isNetscape:function(){return this.fIsNetscape},isPocketIE:function(){return this.fIsPocketIE},console:{mIsActive:false,mLevel:2,ALL:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5,isDebugEnabled:function(){return(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.DEBUG)},isInfoEnabled:function(){return(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.INFO)},log:function(a){if(window.console&&jws.console.mIsActive){console.log(a)}},debug:function(a){if(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.DEBUG){if(console.debug){console.debug(a)}else{console.log("[debug]: "+a)}}},info:function(a){if(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.INFO){if(console.info){console.info(a)}else{console.log("[info]: "+a)}}},warn:function(a){if(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.WARN){if(console.warn){console.warn(a)}else{console.log("[warn]: "+a)}}},error:function(a){if(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.ERROR){if(console.error){console.error(a)}else{console.log("[error]: "+a)}}},fatal:function(a){if(window.console&&jws.console.mIsActive&&jws.console.mLevel<=jws.console.FATAL){if(console.fatal){console.fatal(a)}else{console.log("[fatal]: "+a)}}},getLevel:function(){return jws.console.mLevel},setLevel:function(a){jws.console.mLevel=a},isActive:function(){return jws.console.mIsActive},setActive:function(a){jws.console.mIsActive=a}}};(function(){jws.fBrowserName="unknown";jws.fBrowserType=jws.BT_UNKNOWN;jws.fBrowserVerNo=undefined;jws.fIsIExplorer=false;jws.fIsFirefox=false;jws.fIsNetscape=false;jws.fIsOpera=false;jws.fIsSafari=false;jws.fIsChrome=false;var c=navigator.userAgent;jws.fIsChrome=c.indexOf("Chrome")>=0;if(jws.fIsChrome){jws.fBrowserType=jws.BT_CHROME}else{jws.fIsSafari=c.indexOf("Safari")>=0;if(jws.fIsSafari){jws.fBrowserType=jws.BT_SAFARI}else{jws.fIsNetscape=c.indexOf("Netscape")>=0;if(jws.fIsNetscape){jws.fBrowserType=jws.BT_NETSCAPE}else{jws.fIsFirefox=navigator.appName=="Netscape";if(jws.fIsFirefox){jws.fBrowserType=jws.BT_FIREFOX}else{jws.fIsOpera=navigator.appName=="Opera";if(jws.fIsOpera){jws.fBrowserType=jws.BT_OPERA}else{jws.fIsIExplorer=navigator.appName=="Microsoft Internet Explorer";if(jws.fIsIExplorer){jws.fBrowserType=jws.BT_IEXPLORER}else{jws.fIsPocketIE=navigator.appName=="Microsoft Pocket Internet Explorer";if(jws.fIsPocketIE){jws.fBrowserType=jws.BT_IEXPLORER}}}}}}}var f,d;var a;var e;var b;if(jws.fIsIExplorer){jws.fBrowserName=jws.BROWSER_NAMES[jws.BT_IEXPLORER];b=c.match(/MSIE.*/i);if(b){a=b[0].substr(5);f=a.indexOf(";");jws.fBrowserVerStr=f>0?a.substr(0,f):a;jws.fBrowserVerNo=parseFloat(jws.fBrowserVerStr)}}else{if(jws.fIsFirefox){jws.fBrowserName=jws.BROWSER_NAMES[jws.BT_FIREFOX];b=c.match(/Firefox\/.*/i);if(b){a=b[0].substr(8);f=a.indexOf(" ");if(f>0){jws.fBrowserVerStr=a.substring(0,f)}else{jws.fBrowserVerStr=a}e=0;d=0;while(d<a.length){if(a.charAt(d)=="."){e++}if(e>=2){break}d++}a=a.substring(0,d);jws.fBrowserVerNo=parseFloat(a)}}else{if(jws.fIsNetscape){jws.fBrowserName=jws.BROWSER_NAMES[jws.BT_NETSCAPE];b=c.match(/Netscape\/.*/i);if(b){a=b[0].substr(9);f=a.indexOf(" ");if(f>0){jws.fBrowserVerStr=a.substring(0,f)}else{jws.fBrowserVerStr=a}e=0;d=0;while(d<a.length){if(a.charAt(d)=="."){e++}if(e>=2){break}d++}a=a.substring(0,d);jws.fBrowserVerNo=parseFloat(a)}}else{if(jws.fIsOpera){jws.fBrowserName=jws.BROWSER_NAMES[jws.BT_OPERA];b=c.match(/Opera\/.*/i);if(b){a=b[0].substr(6);f=a.indexOf(" ");jws.fBrowserVerStr=f>0?a.substr(0,f):a;jws.fBrowserVerNo=parseFloat(a);b=c.match(/Version\/.*/i);a=b[0].substr(8);if(b){f=a.indexOf(" ");jws.fBrowserVerStr=(f>0?a.substr(0,f):a)+"/"+jws.fBrowserVerStr;jws.fBrowserVerNo=parseFloat(a)}}}else{if(jws.fIsChrome){jws.fBrowserName=jws.BROWSER_NAMES[jws.BT_CHROME];b=c.match(/Chrome\/.*/i);if(b){a=b[0].substr(7);f=a.indexOf(" ");jws.fBrowserVerStr=f>0?a.substr(0,f):a;jws.fBrowserVerNo=parseFloat(a)}}else{if(jws.fIsSafari){jws.fBrowserName=jws.BROWSER_NAMES[jws.BT_SAFARI];b=c.match(/Version\/.*/i);if(b){a=b[0].substr(8);f=a.indexOf(" ");jws.fBrowserVerStr=f>0?a.substr(0,f):a;e=0;d=0;while(d<a.length){if(a.charAt(d)=="."){e++}if(e>=2){break}d++}a=a.substring(0,d);jws.fBrowserVerNo=parseFloat(a);b=c.match(/Safari\/.*/i);if(b){a="."+b[0].substr(7);f=a.indexOf(" ");jws.fBrowserVerStr+=f>0?a.substr(0,f):a}}}}}}}}}());jws.events={addEventListener:(jws.isIE?function(b,a,c){b.attachEvent("on"+a,c)}:function(b,a,c){b.addEventListener(a,c,false)}),removeEventListener:(jws.isIE?function(b,a,c){b.detachEvent("on"+a,c)}:function(b,a,c){b.removeEventListener(a,c,false)}),getTarget:(jws.isIE?function(a){return a.srcElement}:function(a){return a.target}),preventDefault:(jws.isIE?function(a){a=window.event;if(a){a.returnValue=false}}:function(a){return a.preventDefault()})};var hexcase=0;var b64pad="";function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))}function b64_md5(a){return rstr2b64(rstr_md5(str2rstr_utf8(a)))}function any_md5(a,b){return rstr2any(rstr_md5(str2rstr_utf8(a)),b)}function hex_hmac_md5(a,b){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function b64_hmac_md5(a,b){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(b)))}function any_hmac_md5(a,c,b){return rstr2any(rstr_hmac_md5(str2rstr_utf8(a),str2rstr_utf8(c)),b)}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),a.length*8))}function rstr_hmac_md5(c,f){var e=rstr2binl(c);if(e.length>16){e=binl_md5(e,c.length*8)}var a=Array(16),d=Array(16);for(var b=0;b<16;b++){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=binl_md5(a.concat(rstr2binl(f)),512+f.length*8);return binl2rstr(binl_md5(d.concat(g),512+128))}function rstr2hex(c){try{hexcase}catch(g){hexcase=0}var f=hexcase?"0123456789ABCDEF":"0123456789abcdef";var b="";var a;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);b+=f.charAt((a>>>4)&15)+f.charAt(a&15)}return b}function rstr2b64(c){try{b64pad}catch(h){b64pad=""}var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b="";var a=c.length;for(var f=0;f<a;f+=3){var k=(c.charCodeAt(f)<<16)|(f+1<a?c.charCodeAt(f+1)<<8:0)|(f+2<a?c.charCodeAt(f+2):0);for(var d=0;d<4;d++){if(f*8+d*6>c.length*8){b+=b64pad}else{b+=g.charAt((k>>>6*(3-d))&63)}}}return b}function rstr2any(m,c){var b=c.length;var l,f,a,n,e;var k=Array(Math.ceil(m.length/2));for(l=0;l<k.length;l++){k[l]=(m.charCodeAt(l*2)<<8)|m.charCodeAt(l*2+1)}var h=Math.ceil(m.length*8/(Math.log(c.length)/Math.log(2)));var g=Array(h);for(f=0;f<h;f++){e=Array();n=0;for(l=0;l<k.length;l++){n=(n<<16)+k[l];a=Math.floor(n/b);n-=a*b;if(e.length>0||a>0){e[e.length]=a}}g[f]=n;k=e}var d="";for(l=g.length-1;l>=0;l--){d+=c.charAt(g[l])}return d}function str2rstr_utf8(c){var b="";var d=-1;var a,e;while(++d<c.length){a=c.charCodeAt(d);e=d+1<c.length?c.charCodeAt(d+1):0;if(55296<=a&&a<=56319&&56320<=e&&e<=57343){a=65536+((a&1023)<<10)+(e&1023);d++}if(a<=127){b+=String.fromCharCode(a)}else{if(a<=2047){b+=String.fromCharCode(192|((a>>>6)&31),128|(a&63))}else{if(a<=65535){b+=String.fromCharCode(224|((a>>>12)&15),128|((a>>>6)&63),128|(a&63))}else{if(a<=2097151){b+=String.fromCharCode(240|((a>>>18)&7),128|((a>>>12)&63),128|((a>>>6)&63),128|(a&63))}}}}}return b}function str2rstr_utf16le(b){var a="";for(var c=0;c<b.length;c++){a+=String.fromCharCode(b.charCodeAt(c)&255,(b.charCodeAt(c)>>>8)&255)}return a}function str2rstr_utf16be(b){var a="";for(var c=0;c<b.length;c++){a+=String.fromCharCode((b.charCodeAt(c)>>>8)&255,b.charCodeAt(c)&255)}return a}function rstr2binl(b){var a=Array(b.length>>2);for(var c=0;c<a.length;c++){a[c]=0}for(var c=0;c<b.length*8;c+=8){a[c>>5]|=(b.charCodeAt(c/8)&255)<<(c%32)}return a}function binl2rstr(b){var a="";for(var c=0;c<b.length*32;c+=8){a+=String.fromCharCode((b[c>>5]>>>(c%32))&255)}return a}function binl_md5(p,k){p[k>>5]|=128<<((k)%32);p[(((k+64)>>>9)<<4)+14]=k;var o=1732584193;var n=-271733879;var m=-1732584194;var l=271733878;for(var g=0;g<p.length;g+=16){var j=o;var h=n;var f=m;var e=l;o=md5_ff(o,n,m,l,p[g+0],7,-680876936);l=md5_ff(l,o,n,m,p[g+1],12,-389564586);m=md5_ff(m,l,o,n,p[g+2],17,606105819);n=md5_ff(n,m,l,o,p[g+3],22,-1044525330);o=md5_ff(o,n,m,l,p[g+4],7,-176418897);l=md5_ff(l,o,n,m,p[g+5],12,1200080426);m=md5_ff(m,l,o,n,p[g+6],17,-1473231341);n=md5_ff(n,m,l,o,p[g+7],22,-45705983);o=md5_ff(o,n,m,l,p[g+8],7,1770035416);l=md5_ff(l,o,n,m,p[g+9],12,-1958414417);m=md5_ff(m,l,o,n,p[g+10],17,-42063);n=md5_ff(n,m,l,o,p[g+11],22,-1990404162);o=md5_ff(o,n,m,l,p[g+12],7,1804603682);l=md5_ff(l,o,n,m,p[g+13],12,-40341101);m=md5_ff(m,l,o,n,p[g+14],17,-1502002290);n=md5_ff(n,m,l,o,p[g+15],22,1236535329);o=md5_gg(o,n,m,l,p[g+1],5,-165796510);l=md5_gg(l,o,n,m,p[g+6],9,-1069501632);m=md5_gg(m,l,o,n,p[g+11],14,643717713);n=md5_gg(n,m,l,o,p[g+0],20,-373897302);o=md5_gg(o,n,m,l,p[g+5],5,-701558691);l=md5_gg(l,o,n,m,p[g+10],9,38016083);m=md5_gg(m,l,o,n,p[g+15],14,-660478335);n=md5_gg(n,m,l,o,p[g+4],20,-405537848);o=md5_gg(o,n,m,l,p[g+9],5,568446438);l=md5_gg(l,o,n,m,p[g+14],9,-1019803690);m=md5_gg(m,l,o,n,p[g+3],14,-187363961);n=md5_gg(n,m,l,o,p[g+8],20,1163531501);o=md5_gg(o,n,m,l,p[g+13],5,-1444681467);l=md5_gg(l,o,n,m,p[g+2],9,-51403784);m=md5_gg(m,l,o,n,p[g+7],14,1735328473);n=md5_gg(n,m,l,o,p[g+12],20,-1926607734);o=md5_hh(o,n,m,l,p[g+5],4,-378558);l=md5_hh(l,o,n,m,p[g+8],11,-2022574463);m=md5_hh(m,l,o,n,p[g+11],16,1839030562);n=md5_hh(n,m,l,o,p[g+14],23,-35309556);o=md5_hh(o,n,m,l,p[g+1],4,-1530992060);l=md5_hh(l,o,n,m,p[g+4],11,1272893353);m=md5_hh(m,l,o,n,p[g+7],16,-155497632);n=md5_hh(n,m,l,o,p[g+10],23,-1094730640);o=md5_hh(o,n,m,l,p[g+13],4,681279174);l=md5_hh(l,o,n,m,p[g+0],11,-358537222);m=md5_hh(m,l,o,n,p[g+3],16,-722521979);n=md5_hh(n,m,l,o,p[g+6],23,76029189);o=md5_hh(o,n,m,l,p[g+9],4,-640364487);l=md5_hh(l,o,n,m,p[g+12],11,-421815835);m=md5_hh(m,l,o,n,p[g+15],16,530742520);n=md5_hh(n,m,l,o,p[g+2],23,-995338651);o=md5_ii(o,n,m,l,p[g+0],6,-198630844);l=md5_ii(l,o,n,m,p[g+7],10,1126891415);m=md5_ii(m,l,o,n,p[g+14],15,-1416354905);n=md5_ii(n,m,l,o,p[g+5],21,-57434055);o=md5_ii(o,n,m,l,p[g+12],6,1700485571);l=md5_ii(l,o,n,m,p[g+3],10,-1894986606);m=md5_ii(m,l,o,n,p[g+10],15,-1051523);n=md5_ii(n,m,l,o,p[g+1],21,-2054922799);o=md5_ii(o,n,m,l,p[g+8],6,1873313359);l=md5_ii(l,o,n,m,p[g+15],10,-30611744);m=md5_ii(m,l,o,n,p[g+6],15,-1560198380);n=md5_ii(n,m,l,o,p[g+13],21,1309151649);o=md5_ii(o,n,m,l,p[g+4],6,-145523070);l=md5_ii(l,o,n,m,p[g+11],10,-1120210379);m=md5_ii(m,l,o,n,p[g+2],15,718787259);n=md5_ii(n,m,l,o,p[g+9],21,-343485551);o=safe_add(o,j);n=safe_add(n,h);m=safe_add(m,f);l=safe_add(l,e)}return Array(o,n,m,l)}function md5_cmn(h,e,d,c,g,f){return safe_add(bit_rol(safe_add(safe_add(e,h),safe_add(c,f)),g),d)}function md5_ff(g,f,k,j,e,i,h){return md5_cmn((f&k)|((~f)&j),g,f,e,i,h)}function md5_gg(g,f,k,j,e,i,h){return md5_cmn((f&j)|(k&(~j)),g,f,e,i,h)}function md5_hh(g,f,k,j,e,i,h){return md5_cmn(f^k^j,g,f,e,i,h)}function md5_ii(g,f,k,j,e,i,h){return md5_cmn(k^(f|(~j)),g,f,e,i,h)}function safe_add(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)}function bit_rol(a,b){return(a<<b)|(a>>>(32-b))}jws.tools={zerofill:function(a,b){var c=a.toFixed(0);if(c.length>b){c=c.substring(c.length-b)}else{while(c.length<b){c="0"+c}}return c},calcMD5:function(a){return(hex_md5(a))},escapeSQL:function(a){if(a&&typeof aValue=="string"){}return a},date2ISO:function(d){var a=-d.getTimezoneOffset();var c=Math.abs(a);var b=d.getUTCFullYear()+"-"+this.zerofill(d.getUTCMonth()+1,2)+"-"+this.zerofill(d.getUTCDate(),2)+"T"+this.zerofill(d.getUTCHours(),2)+":"+this.zerofill(d.getUTCMinutes(),2)+":"+this.zerofill(d.getUTCSeconds(),2)+"."+this.zerofill(d.getUTCMilliseconds(),3)+"Z";return b},ISO2Date:function(b,a){var c=new Date();c.setUTCFullYear(b.substr(0,4));c.setUTCMonth(b.substr(5,2)-1);c.setUTCDate(b.substr(8,2));c.setUTCHours(b.substr(11,2));c.setUTCMinutes(b.substr(14,2));c.setUTCSeconds(b.substr(17,2));c.setUTCMilliseconds(b.substr(20,3));return c},date2String:function(b){var a=b.getUTCFullYear()+this.zerofill(b.getUTCMonth()+1,2)+this.zerofill(b.getUTCDate(),2)+this.zerofill(b.getUTCHours(),2)+this.zerofill(b.getUTCMinutes(),2)+this.zerofill(b.getUTCSeconds(),2)+this.zerofill(b.getUTCMilliseconds(),2);return a},string2Date:function(a){var b=new Date();b.setUTCFullYear(a.substr(0,4));b.setUTCMonth(a.substr(4,2)-1);b.setUTCDate(a.substr(6,2));b.setUTCHours(a.substr(8,2));b.setUTCMinutes(a.substr(10,2));b.setUTCSeconds(a.substr(12,2));b.setUTCMilliseconds(a.substr(14,3));return b},generateSharedUTID:function(b){var a=JSON.stringify(b);var c=a.split("");c.sort();return hex_md5("{"+c.toString()+"}")},getType:function(a){var c=a;var b=typeof c;if("number"==b){if((parseFloat(c)==parseInt(c))){b="integer"}else{b="double"}}else{if(Object.prototype.toString.call(c)==="[object Array]"){b="array"}else{if(c===null){b="null"}}}return b},setProperties:function(a,c,f){var b=f||"";var d=null;var e=null;for(e in c){d="set"+e.substr(0,1).toUpperCase()+e.substr(1);if(typeof(a[d])=="function"){a[d](c[e])}else{a[b+e]=c[e]}}return a},clone:function(b){if(null==b||"object"!=typeof(aObj)){return b}if("function"==typeof(b.clone)){return b.clone()}if(b instanceof Date){return new Date(b.getTime())}var d=function(i){var f=i.length;var h=[];if(f>0){for(var g=0;g<f;g++){h[g]=jws.tools.clone(i[g])}}return h};var c=new b.constructor();for(var a in b){var e=b[a];if(e instanceof Array){c[a]=d(e)}else{c[a]=jws.tools.clone(e)}}return c}};if(!jws.browserSupportsNativeWebSockets){var swfobject=function(){var aq="undefined",aD="object",ab="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",aE="application/x-shockwave-flash",ac="SWFObjectExprInst",ax="onreadystatechange",af=window,aL=document,aB=navigator,aa=false,Z=[aN],aG=[],ag=[],al=[],aJ,ad,ap,at,ak=false,aU=false,aH,an,aI=true,ah=function(){var a=typeof aL.getElementById!=aq&&typeof aL.getElementsByTagName!=aq&&typeof aL.createElement!=aq,e=aB.userAgent.toLowerCase(),c=aB.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(e),j=c?/mac/.test(c):/mac/.test(e),g=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,d=!+"\v1",f=[0,0,0],k=null;if(typeof aB.plugins!=aq&&typeof aB.plugins[ab]==aD){k=aB.plugins[ab].description;if(k&&!(typeof aB.mimeTypes!=aq&&aB.mimeTypes[aE]&&!aB.mimeTypes[aE].enabledPlugin)){aa=true;d=false;k=k.replace(/^.*\s+(\S+\s+\S+$)/,"$1");f[0]=parseInt(k.replace(/^(.*)\..*$/,"$1"),10);f[1]=parseInt(k.replace(/^.*\.(.*)\s.*$/,"$1"),10);f[2]=/[a-zA-Z]/.test(k)?parseInt(k.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof af.ActiveXObject!=aq){try{var i=new ActiveXObject(X);if(i){k=i.GetVariable("$version");if(k){d=true;k=k.split(" ")[1].split(",");f=[parseInt(k[0],10),parseInt(k[1],10),parseInt(k[2],10)]}}}catch(b){}}}return{w3:a,pv:f,wk:g,ie:d,win:h,mac:j}}(),aK=function(){if(!ah.w3){return}if((typeof aL.readyState!=aq&&aL.readyState=="complete")||(typeof aL.readyState==aq&&(aL.getElementsByTagName("body")[0]||aL.body))){aP()}if(!ak){if(typeof aL.addEventListener!=aq){aL.addEventListener("DOMContentLoaded",aP,false)}if(ah.ie&&ah.win){aL.attachEvent(ax,function(){if(aL.readyState=="complete"){aL.detachEvent(ax,arguments.callee);aP()}});if(af==top){(function(){if(ak){return}try{aL.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}aP()})()}}if(ah.wk){(function(){if(ak){return}if(!/loaded|complete/.test(aL.readyState)){setTimeout(arguments.callee,0);return}aP()})()}aC(aP)}}();function aP(){if(ak){return}try{var b=aL.getElementsByTagName("body")[0].appendChild(ar("span"));b.parentNode.removeChild(b)}catch(a){return}ak=true;var d=Z.length;for(var c=0;c<d;c++){Z[c]()}}function aj(a){if(ak){a()}else{Z[Z.length]=a}}function aC(a){if(typeof af.addEventListener!=aq){af.addEventListener("load",a,false)}else{if(typeof aL.addEventListener!=aq){aL.addEventListener("load",a,false)}else{if(typeof af.attachEvent!=aq){aM(af,"onload",a)}else{if(typeof af.onload=="function"){var b=af.onload;af.onload=function(){b();a()}}else{af.onload=a}}}}}function aN(){if(aa){Y()}else{am()}}function Y(){var d=aL.getElementsByTagName("body")[0];var b=ar(aD);b.setAttribute("type",aE);var a=d.appendChild(b);if(a){var c=0;(function(){if(typeof a.GetVariable!=aq){var e=a.GetVariable("$version");if(e){e=e.split(" ")[1].split(",");ah.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]}}else{if(c<10){c++;setTimeout(arguments.callee,10);return}}d.removeChild(b);a=null;am()})()}else{am()}}function am(){var g=aG.length;if(g>0){for(var h=0;h<g;h++){var c=aG[h].id;var l=aG[h].callbackFn;var a={success:false,id:c};if(ah.pv[0]>0){var i=aS(c);if(i){if(ao(aG[h].swfVersion)&&!(ah.wk&&ah.wk<312)){ay(c,true);if(l){a.success=true;a.ref=av(c);l(a)}}else{if(aG[h].expressInstall&&au()){var e={};e.data=aG[h].expressInstall;e.width=i.getAttribute("width")||"0";e.height=i.getAttribute("height")||"0";if(i.getAttribute("class")){e.styleclass=i.getAttribute("class")}if(i.getAttribute("align")){e.align=i.getAttribute("align")}var f={};var d=i.getElementsByTagName("param");var k=d.length;for(var j=0;j<k;j++){if(d[j].getAttribute("name").toLowerCase()!="movie"){f[d[j].getAttribute("name")]=d[j].getAttribute("value")}}ae(e,f,c,l)}else{aF(i);if(l){l(a)}}}}}else{ay(c,true);if(l){var b=av(c);if(b&&typeof b.SetVariable!=aq){a.success=true;a.ref=b}l(a)}}}}}function av(b){var d=null;var c=aS(b);if(c&&c.nodeName=="OBJECT"){if(typeof c.SetVariable!=aq){d=c}else{var a=c.getElementsByTagName(aD)[0];if(a){d=a}}}return d}function au(){return !aU&&ao("6.0.65")&&(ah.win||ah.mac)&&!(ah.wk&&ah.wk<312)}function ae(f,d,h,e){aU=true;ap=e||null;at={success:false,id:h};var a=aS(h);if(a){if(a.nodeName=="OBJECT"){aJ=aO(a);ad=null}else{aJ=a;ad=h}f.id=ac;if(typeof f.width==aq||(!/%$/.test(f.width)&&parseInt(f.width,10)<310)){f.width="310"}if(typeof f.height==aq||(!/%$/.test(f.height)&&parseInt(f.height,10)<137)){f.height="137"}aL.title=aL.title.slice(0,47)+" - Flash Player Installation";var b=ah.ie&&ah.win?"ActiveX":"PlugIn",c="MMredirectURL="+af.location.toString().replace(/&/g,"%26")+"&MMplayerType="+b+"&MMdoctitle="+aL.title;if(typeof d.flashvars!=aq){d.flashvars+="&"+c}else{d.flashvars=c}if(ah.ie&&ah.win&&a.readyState!=4){var g=ar("div");h+="SWFObjectNew";g.setAttribute("id",h);a.parentNode.insertBefore(g,a);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}aA(f,d,h)}}function aF(a){if(ah.ie&&ah.win&&a.readyState!=4){var b=ar("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(aO(a),b);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(aO(a),a)}}function aO(b){var d=ar("div");if(ah.win&&ah.ie){d.innerHTML=b.innerHTML}else{var e=b.getElementsByTagName(aD)[0];if(e){var a=e.childNodes;if(a){var f=a.length;for(var c=0;c<f;c++){if(!(a[c].nodeType==1&&a[c].nodeName=="PARAM")&&!(a[c].nodeType==8)){d.appendChild(a[c].cloneNode(true))}}}}}return d}function aA(e,g,c){var d,a=aS(c);if(ah.wk&&ah.wk<312){return d}if(a){if(typeof e.id==aq){e.id=c}if(ah.ie&&ah.win){var f="";for(var i in e){if(e[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){g.movie=e[i]}else{if(i.toLowerCase()=="styleclass"){f+=' class="'+e[i]+'"'}else{if(i.toLowerCase()!="classid"){f+=" "+i+'="'+e[i]+'"'}}}}}var h="";for(var j in g){if(g[j]!=Object.prototype[j]){h+='<param name="'+j+'" value="'+g[j]+'" />'}}a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>";ag[ag.length]=e.id;d=aS(e.id)}else{var b=ar(aD);b.setAttribute("type",aE);for(var k in e){if(e[k]!=Object.prototype[k]){if(k.toLowerCase()=="styleclass"){b.setAttribute("class",e[k])}else{if(k.toLowerCase()!="classid"){b.setAttribute(k,e[k])}}}}for(var l in g){if(g[l]!=Object.prototype[l]&&l.toLowerCase()!="movie"){aQ(b,l,g[l])}}a.parentNode.replaceChild(b,a);d=b}}return d}function aQ(b,d,c){var a=ar("param");a.setAttribute("name",d);a.setAttribute("value",c);b.appendChild(a)}function aw(a){var b=aS(a);if(b&&b.nodeName=="OBJECT"){if(ah.ie&&ah.win){b.style.display="none";(function(){if(b.readyState==4){aT(a)}else{setTimeout(arguments.callee,10)}})()}else{b.parentNode.removeChild(b)}}}function aT(a){var b=aS(a);if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null}}b.parentNode.removeChild(b)}}function aS(a){var c=null;try{c=aL.getElementById(a)}catch(b){}return c}function ar(a){return aL.createElement(a)}function aM(a,c,b){a.attachEvent(c,b);al[al.length]=[a,c,b]}function ao(a){var b=ah.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return(b[0]>c[0]||(b[0]==c[0]&&b[1]>c[1])||(b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]))?true:false}function az(b,f,a,c){if(ah.ie&&ah.mac){return}var e=aL.getElementsByTagName("head")[0];if(!e){return}var g=(a&&typeof a=="string")?a:"screen";if(c){aH=null;an=null}if(!aH||an!=g){var d=ar("style");d.setAttribute("type","text/css");d.setAttribute("media",g);aH=e.appendChild(d);if(ah.ie&&ah.win&&typeof aL.styleSheets!=aq&&aL.styleSheets.length>0){aH=aL.styleSheets[aL.styleSheets.length-1]}an=g}if(ah.ie&&ah.win){if(aH&&typeof aH.addRule==aD){aH.addRule(b,f)}}else{if(aH&&typeof aL.createTextNode!=aq){aH.appendChild(aL.createTextNode(b+" {"+f+"}"))}}}function ay(a,c){if(!aI){return}var b=c?"visible":"hidden";if(ak&&aS(a)){aS(a).style.visibility=b}else{az("#"+a,"visibility:"+b)}}function ai(b){var a=/[\\\"<>\.;]/;var c=a.exec(b)!=null;return c&&typeof encodeURIComponent!=aq?encodeURIComponent(b):b}var aR=function(){if(ah.ie&&ah.win){window.attachEvent("onunload",function(){var a=al.length;for(var b=0;b<a;b++){al[b][0].detachEvent(al[b][1],al[b][2])}var d=ag.length;for(var c=0;c<d;c++){aw(ag[c])}for(var e in ah){ah[e]=null}ah=null;for(var f in swfobject){swfobject[f]=null}swfobject=null})}}();return{registerObject:function(a,e,c,b){if(ah.w3&&a&&e){var d={};d.id=a;d.swfVersion=e;d.expressInstall=c;d.callbackFn=b;aG[aG.length]=d;ay(a,false)}else{if(b){b({success:false,id:a})}}},getObjectById:function(a){if(ah.w3){return av(a)}},embedSWF:function(k,e,h,f,c,a,b,i,g,j){var d={success:false,id:e};if(ah.w3&&!(ah.wk&&ah.wk<312)&&k&&e&&h&&f&&c){ay(e,false);aj(function(){h+="";f+="";var q={};if(g&&typeof g===aD){for(var o in g){q[o]=g[o]}}q.data=k;q.width=h;q.height=f;var n={};if(i&&typeof i===aD){for(var p in i){n[p]=i[p]}}if(b&&typeof b===aD){for(var l in b){if(typeof n.flashvars!=aq){n.flashvars+="&"+l+"="+b[l]}else{n.flashvars=l+"="+b[l]}}}if(ao(c)){var m=aA(q,n,e);if(q.id==e){ay(e,true)}d.success=true;d.ref=m}else{if(a&&au()){q.data=a;ae(q,n,e,j);return}else{ay(e,true)}}if(j){j(d)}})}else{if(j){j(d)}}},switchOffAutoHideShow:function(){aI=false},ua:ah,getFlashPlayerVersion:function(){return{major:ah.pv[0],minor:ah.pv[1],release:ah.pv[2]}},hasFlashPlayerVersion:ao,createSWF:function(a,b,c){if(ah.w3){return aA(a,b,c)}else{return undefined}},showExpressInstall:function(b,a,d,c){if(ah.w3&&au()){ae(b,a,d,c)}},removeSWF:function(a){if(ah.w3){aw(a)}},createCSS:function(b,a,c,d){if(ah.w3){az(b,a,c,d)}},addDomLoadEvent:aj,addLoadEvent:aC,getQueryParamValue:function(b){var a=aL.location.search||aL.location.hash;if(a){if(/\?/.test(a)){a=a.split("?")[1]}if(b==null){return ai(a)}var c=a.split("&");for(var d=0;d<c.length;d++){if(c[d].substring(0,c[d].indexOf("="))==b){return ai(c[d].substring((c[d].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(aU){var a=aS(ac);if(a&&aJ){a.parentNode.replaceChild(aJ,a);if(ad){ay(ad,true);if(ah.ie&&ah.win){aJ.style.display="block"}}if(ap){ap(at)}}aU=false}}}}();if(swfobject.hasFlashPlayerVersion("10.0.0")){WEB_SOCKET_DEBUG=true;(function(){var c=document.getElementsByTagName("script");for(var b=0,e=c.length;b<e;b++){var f=c[b];var d=f.src;if(!d){d=f.getAttribute("src")}if(d){var a=d.lastIndexOf("jWebSocket_Bundle_min.js");if(a<0){a=d.lastIndexOf("jWebSocket_Bundle.js")}if(a<0){a=d.lastIndexOf("jWebSocket.js")}if(a>0){window.WEB_SOCKET_SWF_LOCATION=d.substr(0,a)+"flash-bridge/WebSocketMain.swf";jws.JWS_FLASHBRIDGE=window.WEB_SOCKET_SWF_LOCATION;break}}}})();if(window.WEB_SOCKET_SWF_LOCATION){(function(){if(window.WEB_SOCKET_FORCE_FLASH){}else{if(window.WebSocket){return}else{if(window.MozWebSocket){window.WebSocket=MozWebSocket;return}}}var a;if(window.WEB_SOCKET_LOGGER){a=WEB_SOCKET_LOGGER}else{if(window.console&&window.console.log&&window.console.error){a=window.console}else{a={log:function(){},error:function(){}}}}if(swfobject.getFlashPlayerVersion().major<10){a.error("Flash Player >= 10.0.0 is required.");return}if(location.protocol=="file:"){a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...")}window.WebSocket=function(d,e,c,g,f){var b=this;b.__id=WebSocket.__nextId++;WebSocket.__instances[b.__id]=b;b.readyState=WebSocket.CONNECTING;b.bufferedAmount=0;b.__events={};if(!e){e=[]}else{if(typeof e=="string"){e=[e]}}b.__createTask=setTimeout(function(){WebSocket.__addTask(function(){b.__createTask=null;WebSocket.__flash.create(b.__id,d,e,c||null,g||0,f||null)})},0)};WebSocket.prototype.send=function(c){if(this.readyState==WebSocket.CONNECTING){throw"INVALID_STATE_ERR: Web Socket connection has not been established"}var b=WebSocket.__flash.send(this.__id,encodeURIComponent(c));if(b<0){return true}else{this.bufferedAmount+=b;return false}};WebSocket.prototype.close=function(){if(this.__createTask){clearTimeout(this.__createTask);this.__createTask=null;this.readyState=WebSocket.CLOSED;return}if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING){return}this.readyState=WebSocket.CLOSING;WebSocket.__flash.close(this.__id)};WebSocket.prototype.addEventListener=function(c,d,b){if(!(c in this.__events)){this.__events[c]=[]}this.__events[c].push(d)};WebSocket.prototype.removeEventListener=function(e,f,b){if(!(e in this.__events)){return}var d=this.__events[e];for(var c=d.length-1;c>=0;--c){if(d[c]===f){d.splice(c,1);break}}};WebSocket.prototype.dispatchEvent=function(e){var c=this.__events[e.type]||[];for(var b=0;b<c.length;++b){c[b](e)}var d=this["on"+e.type];if(d){d.apply(this,[e])}};WebSocket.prototype.__handleEvent=function(d){if("readyState" in d){this.readyState=d.readyState}if("protocol" in d){this.protocol=d.protocol}var b;if(d.type=="open"||d.type=="error"){b=this.__createSimpleEvent(d.type)}else{if(d.type=="close"){b=this.__createSimpleEvent("close");b.wasClean=d.wasClean?true:false;b.code=d.code;b.reason=d.reason}else{if(d.type=="message"){var c=decodeURIComponent(d.message);b=this.__createMessageEvent("message",c)}else{throw"unknown event type: "+d.type}}}this.dispatchEvent(b)};WebSocket.prototype.__createSimpleEvent=function(b){if(document.createEvent&&window.Event){var c=document.createEvent("Event");c.initEvent(b,false,false);return c}else{return{type:b,bubbles:false,cancelable:false}}};WebSocket.prototype.__createMessageEvent=function(b,d){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",false,false,d,null,null,window,null);return c}else{return{type:b,data:d,bubbles:false,cancelable:false}}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__initialized=false;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(b){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(b)})};WebSocket.__initialize=function(){if(WebSocket.__initialized){return}WebSocket.__initialized=true;if(WebSocket.__swfLocation){window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation}if(!window.WEB_SOCKET_SWF_LOCATION){a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var d=RegExp.$1;if(location.host!=d){a.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+d+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}}var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";if(WebSocket.__isFlashLite()){b.style.left="0px";b.style.top="0px"}else{b.style.left="-100px";b.style.top="-100px"}var c=document.createElement("div");c.id="webSocketFlash";b.appendChild(c);document.body.appendChild(b);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(f){if(!f.success){a.error("[WebSocket] swfobject.embedSWF failed")}})};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var b=0;b<WebSocket.__tasks.length;++b){WebSocket.__tasks[b]()}WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{var c=WebSocket.__flash.receiveEvents();for(var b=0;b<c.length;++b){WebSocket.__instances[c[b].webSocketId].__handleEvent(c[b])}}catch(d){a.error(d)}},0);return true};WebSocket.__log=function(b){a.log(decodeURIComponent(b))};WebSocket.__error=function(b){a.error(decodeURIComponent(b))};WebSocket.__addTask=function(b){if(WebSocket.__flash){b()}else{WebSocket.__tasks.push(b)}};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes){return false}var b=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!b||!b.enabledPlugin||!b.enabledPlugin.filename){return false}return b.enabledPlugin.filename.match(/flashlite/i)?true:false};if(!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION){swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})}})()}}else{WebSocket=null}}jws.XHR={ASYNC:true,SYNC:false,METHOD_GET:"get",METHOD_POST:"post",METHOD_HEAD:"head",getXHRInstance:function(){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){throw"f3.cfw.std.ex.xhr.NotAvail"}}}else{throw"f3.cfw.std.ex.xhr.NotAvail"}}return a},isProtocolOk:function(a){if(!a){a=self}return(!(a.location.protocol&&a.location.protocol.toLowerCase()=="file:"))},mXHRSucClbk:function(a,b){throw"f3.cfw.std.ex.xhr.NoSuccObs"},mXHRErrClbk:function(a,b){throw"f3.cfw.std.ex.xhr.NoErrObs"},mXHRRespLsnr:function(){var a=arguments.callee.options;if(f3.ajax.Request!==undefined){if(a.OnReadyStateChange){a.OnReadyStateChange(a.XHR,a)}switch(a.XHR.readyState){case 0:case 1:case 2:case 3:break;case 4:clearTimeout(a.hTimeout);if(a.XHR.status==200){f3.dom.Event.callObserver(a.OnSuccess,a.XHR,a)}else{f3.dom.Event.callObserver(a.OnError,a.XHR,a)}a.XHR=null;a=null;arguments.callee.self=null;arguments.callee.options=null;break;default:a.OnError(a.XHR,a);a.XHR=null;a=null;arguments.callee.self=null;arguments.callee.options=null;break}}},request:function(b,c){c=f3.core.OOP.getDefaultOptions(c,{method:"POST",asynchronous:f3.ajax.Common.ASYNC,postBody:null,timeout:-1,OnSuccess:f3.ajax.Request.mXHRSucClbk,OnError:f3.ajax.Request.mXHRErrClbk,contentType:"text/plain; charset=UTF-8",cacheControl:"must-revalidate"});if(!f3.ajax.Common.isProtocolOk()){throw new Error(0,f3.localeManager.getCurLocStr("f3.cfw.std.ex.xhr.file"))}c.XHR=f3.ajax.Common.getXHRInstance();if(c.XHR){c.XHR.open(c.method,b,c.asynchronous);if(c.method.toLowerCase()=="post"){c.XHR.setRequestHeader("Content-type",c.contentType)}if(c.cacheControl){c.XHR.setRequestHeader("Cache-Control",c.cacheControl)}var a=new $f3.$XHRResponse(c);if(!f3.browser.Browser.isFirefox()||c.asynchronous){c.XHR.onreadystatechange=a.mXHRRespLsnr}else{c.XHR.onreadystatechange=null}if(c.timeout>0){c.hTimeout=setTimeout(function(){c.XHR.abort();if(f3.browser.Browser.isFirefox()&&!c.asynchronous){a.handler(c)}},c.timeout)}try{c.XHR.send(c.postBody)}catch(d){c.OnError(c.XHR,c)}if(f3.browser.Browser.isFirefox()&&!c.asynchronous){a.mXHRRespLsnr(c)}}return c.XHR}};if(!jws.browserSupportsNativeJSON){if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}())}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};jws.oop={};jws.oop.declareClass=function(f,a,d,h){var c=self[f];if(!c){self[f]={}}var b=function(){if(this.create){this.create.apply(this,arguments)}};c[a]=b;var e;for(e in h){b.prototype[e]=h[e]}if(d!=null){if(!d.descendants){d.descendants=[]}d.descendants.push(b);for(e in d.prototype){var g=d.prototype[e];if(typeof g=="function"){if(b.prototype[e]){b.prototype[e].inherited=g}else{b.prototype[e]=g}b.prototype[e].superClass=d}}}};jws.oop.addPlugIn=function(d,c){if(!d.fPlugIns){d.fPlugIns=[]}d.fPlugIns.push(c);for(var e in c){if(!d.prototype[e]){d.prototype[e]=c[e]}}if(d.descendants){for(var a=0,b=d.descendants.length;a<b;a++){jws.oop.addPlugIn(d.descendants[a],c)}}};jws.oop.declareClass("jws","jWebSocketBaseClient",null,{create:function(a){if(!this.fReliabilityOptions){this.fReliabilityOptions=jws.RO_OFF}},processOpened:function(a){},processPacket:function(a){},processClosed:function(a){},open:function(b,c){if(!c){c={}}if(self.WebSocket){if(!this.fConn){var d=this;var a=null;var e=jws.WS_SUBPROT_JSON;if(c.subProtocol){e=c.subProtocol}if(c.reliabilityOptions){this.fReliabilityOptions=c.reliabilityOptions}if(this.fReliabilityOptions){this.fReliabilityOptions.isExplicitClose=false}if(this.fStatus!=jws.RECONNECTING){this.fStatus=jws.CONNECTING}if(c.OnOpenTimeout&&typeof c.OnOpenTimeout=="function"&&c.openTimeout){this.fOpenTimeout=c.openTimeout;this.hOpenTimeout=setTimeout(function(){d.fOpenTimeout=null;var f={};c.OnOpenTimeout(f)},this.fOpenTimeout)}this.fConn=new WebSocket(b,e);this.fURL=b;this.fSubProt=e;this.fConn.onopen=function(f){if(jws.console.isDebugEnabled()){jws.console.debug("[onopen]: "+JSON.stringify(f))}if(d.hOpenTimeout){clearTimeout(d.hOpenTimeout);d.hOpenTimeout=null}d.fStatus=jws.OPEN;a=d.processOpened(f);if(c.OnOpen){c.OnOpen(f,a,d)}d.processQueue()};this.fConn.onmessage=function(f){if(jws.console.isDebugEnabled()){jws.console.debug("[onmessage]: "+JSON.stringify(f))}a=d.processPacket(f);if(c.OnMessage){c.OnMessage(f,a,d)}};this.fConn.onclose=function(f){if(jws.console.isDebugEnabled()){jws.console.debug("[onclose]: "+JSON.stringify(f))}if(d.hOpenTimeout){clearTimeout(d.hOpenTimeout);d.hOpenTimeout=null}d.fStatus=jws.CLOSED;if(d.hDisconnectTimeout){clearTimeout(d.hDisconnectTimeout);delete d.hDisconnectTimeout}a=d.processClosed(f);if(c.OnClose){c.OnClose(f,a,d)}d.fConn=null;if(d.fReliabilityOptions&&d.fReliabilityOptions.autoReconnect&&!d.fReliabilityOptions.isExplicitClose){d.fStatus=jws.RECONNECTING;d.hReconnectDelayTimeout=setTimeout(function(){if(c.OnReconnecting){c.OnReconnecting(f,a,d)}d.open(d.fURL,c)},d.fReliabilityOptions.reconnectDelay)}}}else{throw new Error("Already connected")}}else{throw new Error("WebSockets not supported by browser")}},connect:function(a,b){return this.open(a,b)},processQueue:function(){if(this.fOutQueue){var b=this.checkConnected();if(b.code==0){var a;while(this.fOutQueue.length>0){a=this.fOutQueue.shift();this.fConn.send(a.packet)}}}},queuePacket:function(a,b){if(!this.fOutQueue){this.fOutQueue=[]}this.fOutQueue.push({packet:a,options:b})},sendStream:function(b){if(this.isOpened()){try{this.fConn.send(b)}catch(a){jws.console.error("[sendStream]: Exception on send: "+a.message)}}else{if(this.isWriteable()){this.queuePacket(b,null)}else{throw new Error("Not connected")}}},abortReconnect:function(){if(this.hReconnectDelayTimeout){clearTimeout(this.hReconnectDelayTimeout);this.hReconnectDelayTimeout=null;return true}return false},setAutoReconnect:function(a){if(a&&typeof(aLimit)=="boolean"){this.fReliabilityOptions.autoReconnect=a}else{this.fReliabilityOptions.autoReconnect=false}if(!(this.fReliabilityOptions&&this.fReliabilityOptions.autoReconnect)){abortReconnect()}},setQueueItemLimit:function(a){if(a&&typeof(a)=="number"&&a>0){this.fReliabilityOptions.queueItemLimit=parseInt(a)}else{this.fReliabilityOptions.queueItemLimit=0}},setQueueSizeLimit:function(a){if(a&&typeof(a)=="number"&&a>0){this.fReliabilityOptions.queueSizeLimit=parseInt(a)}else{this.fReliabilityOptions.queueSizeLimit=0}},setReliabilityOptions:function(a){this.fReliabilityOptions=a;if(this.fReliabilityOptions){if(this.fReliabilityOptions.autoReconnect){}else{abortReconnect()}}},getReliabilityOptions:function(){return this.fReliabilityOptions},getOutQueue:function(){return this.fOutQueue},resetSendQueue:function(){delete this.fOutQueue},isOpened:function(){return(this.fConn!=undefined&&this.fConn!=null&&this.fConn.readyState==jws.OPEN)},getURL:function(){return this.fURL},getSubProt:function(){return this.fSubProt},isConnected:function(){return(this.isOpened())},forceClose:function(c){var b=false;if(this.fReliabilityOptions){this.fReliabilityOptions.isExplicitClose=true}if(c){if(c.fireClose&&this.fConn.onclose){var a={};this.fConn.onclose(a)}}if(this.fConn){this.fConn.onopen=null;this.fConn.onmessage=null;this.fConn.onclose=null;if(this.fConn.readyState==jws.OPEN||this.fConn.readyState==jws.CONNECTING){this.fConn.close()}this.processClosed()}this.fConn=null},close:function(b){var a=0;if(b){if(b.timeout){a=b.timeout}}if(this.fConn){if(a<=0){this.forceClose(b)}else{var c=this;this.hDisconnectTimeout=setTimeout(function(){c.forceClose(b)},a)}}else{this.fConn=null;throw new Error("Not connected")}},disconnect:function(a){return this.close(a)},addListener:function(a){if(!this.fListeners){this.fListeners=[]}this.fListeners.push(a)},removeListener:function(a){if(this.fListeners){for(var b=0,c=this.fListeners;b<c;b++){if(a==this.fListeners[b]){this.fListeners.splice(b,1)}}}},addPlugIn:function(a,b){if(!this.fPlugIns){this.fPlugIns=[]}this.fPlugIns.push(a);if(!b){b=a.ID}if(b){a.conn=this}},setParam:function(b,a){if(!this.fParams){this.fParams={}}var c=this.getParam(b);this.fParams[b]=a;return c},getParam:function(b){if(!this.fParams){return null}var a=this.fParams[b];if(a===undefined){return null}return a},setParamNS:function(a,c,b){return this.setParam(a+"."+c,b)},getParamNS:function(a,b){return this.getParam(a+"."+b)},clearParams:function(){if(this.fParams){delete this.fParams}}});jws.oop.declareClass("jws","jWebSocketTokenClient",jws.jWebSocketBaseClient,{create:function(a){arguments.callee.inherited.call(this,a);this.fRequestCallbacks={}},getId:function(){return this.fClientId},checkCallbacks:function(a){var d="utid"+a.utid;var c=this.fRequestCallbacks[d];if(c){if(c.hCleanUp){clearTimeout(c.hCleanUp)}var e=c.args;var b=c.callback;if(b.OnResponse){b.OnResponse.call(this,a,e)}if(b.OnSuccess&&a.code===0){b.OnSuccess.call(this,a,e)}if(b.OnFailure&&a.code!=undefined&&a.code!=0){b.OnFailure.call(this,a,e)}delete this.fRequestCallbacks[d]}},createDefaultResult:function(){return{code:0,msg:"Ok",localeKey:"jws.jsc.res.Ok",args:null,tid:jws.CUR_TOKEN_ID}},checkConnected:function(){var a=this.createDefaultResult();if(!this.isOpened()){a.code=-1;a.localeKey="jws.jsc.res.notConnected";a.msg="Not connected."}return a},isWriteable:function(){return(this.isOpened()||this.fStatus==jws.RECONNECTING)},checkWriteable:function(){var a=this.createDefaultResult();if(!this.isWriteable()){a.code=-1;a.localeKey="jws.jsc.res.notWriteable";a.msg="Not writable."}return a},checkLoggedIn:function(){var a=this.checkConnected();if(a.code==0&&!this.isLoggedIn()){a.code=-1;a.localeKey="jws.jsc.res.notLoggedIn";a.msg="Not logged in."}return a},resultToString:function(a){return((a&&typeof a=="object"&&a.msg?a.msg:"invalid response token"))},tokenToStream:function(a){throw new Error("tokenToStream needs to be overwritten in descendant classes")},streamToToken:function(a){throw new Error("streamToToken needs to be overwritten in descendant classes")},notifyPlugInsOpened:function(){var d={sourceId:this.fClientId};var e=jws.jWebSocketTokenClient.fPlugIns;if(e){for(var b=0,a=e.length;b<a;b++){var c=e[b];if(c.processOpened){c.processOpened.call(this,d)}}}},notifyPlugInsClosed:function(){var d={sourceId:this.fClientId};var e=jws.jWebSocketTokenClient.fPlugIns;if(e){for(var b=0,a=e.length;b<a;b++){var c=e[b];if(c.processClosed){c.processClosed.call(this,d)}}}this.fConn=null;this.fSessionId=null;this.fUsername=null},processPacket:function(b){var a=this.streamToToken(b.data);this.processToken(a);return a},processToken:function(e){var d=e.ns;if(d!=null&&d.indexOf("org.jWebSocket")==1){e.ns="org.jwebsocket"+d.substring(15)}else{if(d==null){e.ns="org.jwebsocket.plugins.system"}}if(jws.NS_SYSTEM==e.ns){if(e.type=="welcome"&&e.usid){this.fSessionId=e.usid;this.fClientId=e.sourceId;this.notifyPlugInsOpened();if(this.fOnWelcome){this.fOnWelcome(e)}var h="n/a";if(swfobject){var f=swfobject.getFlashPlayerVersion();h=f.major+"."+f.minor+"."+f.release}this.sendToken({ns:jws.SystemClientPlugIn.NS,type:"header",clientType:"browser",clientName:jws.getBrowserName(),clientVersion:jws.getBrowserVersionString(),clientInfo:navigator.userAgent,jwsType:"javascript",jwsVersion:jws.VERSION,jwsInfo:jws.browserSupportsNativeWebSockets?"native":"flash "+h},{})}else{if(e.type=="goodBye"){if(this.fOnGoodBye){this.fOnGoodBye(e)}this.fSessionId=null;this.fUsername=null}else{if(e.type=="close"){this.close({timeout:0})}else{if(e.type=="response"){if(e.reqType=="login"){this.fUsername=e.username;if(e.usid){this.fSessionId=e.usid}}if(e.reqType=="logout"){this.fUsername=null}this.checkCallbacks(e)}else{if(e.type=="event"){if(e.name=="connect"){this.processConnected(e)}if(e.name=="disconnect"){this.processDisconnected(e)}}}}}}}else{this.checkCallbacks(e)}var b,a,g,c;g=jws.jWebSocketTokenClient.fPlugIns;if(g){for(b=0,a=g.length;b<a;b++){c=g[b];if(c.processToken){c.processToken.call(this,e)}}}g=this.fPlugIns;if(g){for(b=0,a=g.length;b<a;b++){c=g[b];if(c.processToken){c.processToken(e)}}}if(this.fOnToken){this.fOnToken(e)}if(this.fListeners){for(b=0,a=this.fListeners.length;b<a;b++){this.fListeners[b](e)}}},processClosed:function(a){this.notifyPlugInsClosed();this.fClientId=null},processConnected:function(d){var e=jws.jWebSocketTokenClient.fPlugIns;if(e){for(var b=0,a=e.length;b<a;b++){var c=e[b];if(c.processConnected){c.processConnected.call(this,d)}}}},processDisconnected:function(d){var e=jws.jWebSocketTokenClient.fPlugIns;if(e){for(var b=0,a=e.length;b<a;b++){var c=e[b];if(c.processDisconnected){c.processDisconnected.call(this,d)}}}},sendToken:function(l,q){var i=this.checkWriteable();if(i.code==0){var b=false;var k=0;var m=jws.DEF_RESP_TIMEOUT;var h=false;var t=null;var f={OnResponse:null,OnSuccess:null,OnFailure:null,OnTimeout:null};var g=false;if(q){if(q.OnResponse){f.OnResponse=q.OnResponse;g=true}if(q.OnFailure){f.OnFailure=q.OnFailure;g=true}if(q.OnSuccess){f.OnSuccess=q.OnSuccess;g=true}if(q.OnTimeout){f.OnTimeout=q.OnTimeout;g=true}if(q.args){t=q.args}if(q.timeout){m=q.timeout}if(q.spawnThread){b=q.spawnThread}if(q.fragmentSize){k=q.fragmentSize}if(q.keepRequest){h=true}}jws.CUR_TOKEN_ID++;if(g){var c=jws.CUR_TOKEN_ID;var d="utid"+c;var s=this;var j={request:new Date().getTime(),callback:f,args:t,timeout:m};if(h){j.request=l}this.fRequestCallbacks[d]=j;j.hCleanUp=setTimeout(function(){var u=j.callback;delete s.fRequestCallbacks[d];if(u.OnTimeout){u.OnTimeout.call(this,l,{utid:c,timeout:m})}},m)}if(b){l.spawnThread=true}var e=this.tokenToStream(l);if(k>0&&e.length>0){var r,o,a=0,p=0,n=e.length;while(e.length>0){r={ns:jws.NS_SYSTEM,type:"fragment",utid:l.utid,index:a++,total:parseInt(n/k)+1,data:e.substr(0,k)};p+=k;e=e.substr(k);o=this.tokenToStream(r);this.sendStream(o)}}else{if(jws.console.isDebugEnabled()){jws.console.debug("[sendToken]: Sending stream "+e+"...")}this.sendStream(e)}}return i},getLastTokenId:function(){return jws.CUR_TOKEN_ID},getNextTokenId:function(){return jws.CUR_TOKEN_ID+1},sendText:function(c,a){var b=this.checkLoggedIn();if(b.code==0){this.sendToken({ns:jws.NS_SYSTEM,type:"send",targetId:c,sourceId:this.fClientId,sender:this.fUsername,data:a})}return b},broadcastText:function(a,b,e){var d=this.checkLoggedIn();var c=false;var f=true;if(e){if(e.senderIncluded){c=e.senderIncluded}if(e.responseRequested){f=e.responseRequested}}if(d.code==0){this.sendToken({ns:jws.NS_SYSTEM,type:"broadcast",sourceId:this.fClientId,sender:this.fUsername,pool:a,data:b,senderIncluded:c,responseRequested:f},e)}return d},echo:function(a){var b=this.checkWriteable();if(b.code==0){this.sendToken({ns:jws.NS_SYSTEM,type:"echo",data:a})}return b},open:function(c,d){var b=this.createDefaultResult();try{if(d&&d.OnToken&&typeof d.OnToken=="function"){this.fOnToken=d.OnToken}if(d&&d.OnWelcome&&typeof d.OnWelcome=="function"){this.fOnWelcome=d.OnWelcome}if(d&&d.OnGoodBye&&typeof d.OnGoodBye=="function"){this.fOnGoodBye=d.OnGoodBye}arguments.callee.inherited.call(this,c,d)}catch(a){b.code=-1;b.localeKey="jws.jsc.ex";b.args=[a.message];b.msg="Exception on open: "+a.message}return b},connect:function(a,b){return this.open(a,b)},close:function(f){var e=0;var h=false;var g=false;var c=false;if(this.fReliabilityOptions){this.fReliabilityOptions.isExplicitClose=true}if(f){if(f.timeout){e=f.timeout}if(f.noGoodBye){h=true}if(f.noLogoutBroadcast){g=true}if(f.noDisconnectBroadcast){c=true}}var d=this.checkConnected();try{if(d.code==0){if(e>0){var a={ns:jws.NS_SYSTEM,type:"close",timeout:e};if(h){a.noGoodBye=true}if(g){a.noLogoutBroadcast=true}if(c){a.noDisconnectBroadcast=true}this.sendToken(a)}arguments.callee.inherited.call(this,f)}else{d.code=-1;d.localeKey="jws.jsc.res.notConnected";d.msg="Not connected."}}catch(b){d.code=-1;d.localeKey="jws.jsc.ex";d.args=[b.message];d.msg="Exception on close: "+b.message}return d},disconnect:function(a){return this.close(a)}});jws.SystemClientPlugIn={NS:jws.NS_SYSTEM,ALL_CLIENTS:0,AUTHENTICATED:1,NON_AUTHENTICATED:2,PW_PLAIN:null,PW_ENCODE_MD5:1,PW_MD5_ENCODED:2,processToken:function(a){if(jws.NS_SYSTEM==a.ns){if("login"==a.reqType){if(a.code==0){if(this.fOnLoggedIn){this.fOnLoggedIn(a)}}else{if(this.fOnLoginError){this.fOnLoginError(a)}}}else{if("logout"==a.reqType){if(a.code==0){if(this.fOnLoggedOut){this.fOnLoggedOut(a)}}else{if(this.fOnLogoutError){this.fOnLogoutError(a)}}}}}},login:function(b,c,e){var a=null;var f=null;if(e){if(e.pool!==undefined){a=e.pool}if(e.encoding!==undefined){f=e.encoding;if(jws.SystemClientPlugIn.PW_ENCODE_MD5==f){if(c){c=jws.tools.calcMD5(c)}f="md5"}else{if(jws.SystemClientPlugIn.PW_MD5_ENCODED==f){f="md5"}else{f=null}}}}var d=this.createDefaultResult();if(this.isOpened()){this.sendToken({ns:jws.SystemClientPlugIn.NS,type:"login",username:b,password:c,encoding:f,pool:a})}else{d.code=-1;d.localeKey="jws.jsc.res.notConnected";d.msg="Not connected."}return d},logon:function(e,a,b,f){var d=this.createDefaultResult();if(!f){f={}}if(this.isOpened()){this.login(a,b,f)}else{var c=f.OnWelcome;var g=this;f.OnWelcome=function(h){if(c){c.call(g,h)}g.login(a,b,f)};this.open(e,f)}return d},logout:function(){var a=this.checkConnected();if(a.code==0){this.sendToken({ns:jws.SystemClientPlugIn.NS,type:"logout"})}return a},systemLogon:function(a,c,e){var d=this.checkConnected();if(0==d.code){var b={ns:jws.SystemClientPlugIn.NS,type:"logon",username:a,password:c};this.sendToken(b,e)}return d},systemLogoff:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.SystemClientPlugIn.NS,type:"logoff"};this.sendToken(a,c)}return b},systemGetAuthorities:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.SystemClientPlugIn.NS,type:"getAuthorities"};this.sendToken(a,c)}return b},isLoggedIn:function(){return(this.isOpened()&&this.fUsername)},broadcastToken:function(a,b){a.ns=jws.SystemClientPlugIn.NS;a.type="broadcast";a.sourceId=this.fClientId;a.sender=this.fUsername;return this.sendToken(a,b)},getUsername:function(){return(this.isLoggedIn()?this.fUsername:null)},getClients:function(d){var b=jws.SystemClientPlugIn.ALL_CLIENTS;var a=null;if(d){if(d.mode==jws.SystemClientPlugIn.AUTHENTICATED||d.mode==jws.SystemClientPlugIn.NON_AUTHENTICATED){b=d.mode}if(d.pool){a=d.pool}}var c=this.createDefaultResult();if(this.isLoggedIn()){this.sendToken({ns:jws.SystemClientPlugIn.NS,type:"getClients",mode:b,pool:a})}else{c.code=-1;c.localeKey="jws.jsc.res.notLoggedIn";c.msg="Not logged in."}return c},getNonAuthClients:function(a){if(!a){a={}}a.mode=jws.SystemClientPlugIn.NON_AUTHENTICATED;return this.getClients(a)},getAuthClients:function(a){if(!a){a={}}a.mode=jws.SystemClientPlugIn.AUTHENTICATED;return this.getClients(a)},getAllClients:function(a){if(!a){a={}}a.mode=jws.SystemClientPlugIn.ALL_CLIENTS;return this.getClients(a)},ping:function(b){var c=false;if(b){if(b.echo){c=true}}var a=this.createDefaultResult();if(this.isOpened()){this.sendToken({ns:jws.SystemClientPlugIn.NS,type:"ping",echo:c},b)}else{a.code=-1;a.localeKey="jws.jsc.res.notConnected";a.msg="Not connected."}return a},wait:function(c,b){var a=this.checkConnected();if(a.code==0){var d=true;if(b){if(b.responseRequested!=undefined){d=b.responseRequested}}this.sendToken({ns:jws.SystemClientPlugIn.NS,type:"wait",duration:c,responseRequested:d},b)}return a},startKeepAlive:function(c){if(this.hKeepAlive){stopKeepAlive()}if(!this.isOpened()){return}var b=10000;var e=true;var a=true;if(c){if(c.interval!=undefined){b=c.interval}if(c.echo!=undefined){e=c.echo}if(c.immediate!=undefined){a=c.immediate}}if(a){this.ping({echo:e})}var d=this;this.hKeepAlive=setInterval(function(){if(d.isOpened()){d.ping({echo:e})}else{d.stopKeepAlive()}},b)},stopKeepAlive:function(){if(this.hKeepAlive){clearInterval(this.hKeepAlive);this.hKeepAlive=null}},setSystemCallbacks:function(a){if(!a){a={}}if(a.OnLoggedIn!==undefined){this.fOnLoggedIn=a.OnLoggedIn}if(a.OnLoginError!==undefined){this.fOnLoginError=a.OnLoginError}if(a.OnLoggedOut!==undefined){this.fOnLoggedOut=a.OnLoggedOut}if(a.OnLogoutError!==undefined){this.fOnLogoutError=a.OnLogoutError}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.SystemClientPlugIn);jws.oop.declareClass("jws","jWebSocketJSONClient",jws.jWebSocketTokenClient,{tokenToStream:function(a){a.utid=jws.CUR_TOKEN_ID;var b=JSON.stringify(a);return(b)},streamToToken:function(a){var b=JSON.parse(a);return b}});jws.oop.declareClass("jws","jWebSocketCSVClient",jws.jWebSocketTokenClient,{tokenToStream:function(b){var c="utid="+jws.CUR_TOKEN_ID;for(var d in b){var a=b[d];if(a===null||a===undefined){c+=","+d+"="}else{if(typeof a=="string"){a=a.replace(/[,]/g,"\\x2C");a=a.replace(/["]/g,"\\x22");c+=","+d+'="'+a+'"'}else{c+=","+d+"="+a}}}return c},streamToToken:function(h){var d={};var b=h.split(",");for(var c=0,g=b.length;c<g;c++){var f=b[c].split("=");if(f.length==2){var e=f[0];var a=f[1];if(a.length>=2&&a.charAt(0)=='"'&&a.charAt(a.length-1)=='"'){a=a.replace(/\\x2C/g,"\x2C");a=a.replace(/\\x22/g,"\x22");a=a.substr(1,a.length-2)}d[e]=a}}return d}});jws.oop.declareClass("jws","jWebSocketXMLClient",jws.jWebSocketTokenClient,{tokenToStream:function(c){function b(j,i){var h="";if(i instanceof Array){h+="<"+j+' type="array">';for(var f=0,g=i.length;f<g;f++){h+=b("item",i[f])}h+="</"+j+">"}else{if(typeof i=="object"){h+="<"+j+' type="object">';for(var k in i){h+=b(k,i[k])}h+="</"+j+">"}else{h+="<"+j+' type="'+typeof i+'">'+i.toString()+"</"+j+">"}}return h}var e="windows-1252";var a='<?xml version="1.0" encoding="'+e+'"?><token>';for(var d in c){a+=b(d,c[d])}a+="</token>";return a},streamToToken:function(e){var f=null;try{var d=new DOMParser();f=d.parseFromString(e,"text/xml")}catch(c){}function a(i,l){var h=i.firstChild;while(h!=null){if(h.nodeType==1){var g=h.getAttribute("type");var k=h.nodeName;if(g){var j=h.firstChild;if(j&&j.nodeType==3){j=j.nodeValue;if(j){if(g=="string"){}else{if(g=="number"){}else{if(g=="boolean"){}else{if(g=="date"){}else{j=undefined}}}}if(j){if(l instanceof Array){l.push(j)}else{l[k]=j}}}}else{if(j&&j.nodeType==1){if(g=="array"){l[k]=[];a(h,l[k])}else{if(g=="object"){l[k]={};a(h,l[k])}}}}}}h=h.nextSibling}}var b={};if(f){a(f.firstChild,b)}return b}});var CachePriority={LOW:1,NORMAL:2,HIGH:4};function Cache(c,a,b){this.maxSize_=c||-1;this.debug_=a||false;this.items_=b||new Cache.BasicCacheStorage();this.count_=0;this.fillFactor_=0.75;this.stats_={};this.stats_.hits=0;this.stats_.misses=0;this.log_("Initialized cache with size "+c)}Cache.BasicCacheStorage=function(){this.items_={}};Cache.BasicCacheStorage.prototype.get=function(a){return this.items_[a]};Cache.BasicCacheStorage.prototype.set=function(a,b){this.items_[a]=b};Cache.BasicCacheStorage.prototype.remove=function(a){var b=this.get(a);delete this.items_[a];return b};Cache.BasicCacheStorage.prototype.keys=function(){var a=[],b;for(b in this.items_){a.push(b)}return a};Cache.LocalStorageCacheStorage=function(a){this.prefix_="cache-storage."+(a||"default")+".";var b=this.prefix_.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");this.regexp_=new RegExp("^"+b)};Cache.LocalStorageCacheStorage.prototype.get=function(a){var b=localStorage[this.prefix_+a];if(b){return JSON.parse(b)}return null};Cache.LocalStorageCacheStorage.prototype.set=function(a,b){localStorage[this.prefix_+a]=JSON.stringify(b)};Cache.LocalStorageCacheStorage.prototype.remove=function(a){var b=this.get(a);delete localStorage[this.prefix_+a];return b};Cache.LocalStorageCacheStorage.prototype.keys=function(){var a=[],b;for(b in localStorage){if(b.match(this.regexp_)){a.push(b.replace(this.prefix_,""))}}return a};Cache.prototype.getItem=function(a){var c=this.items_.get(a);if(c!=null){if(!this.isExpired_(c)){c.lastAccessed=new Date().getTime()}else{this.removeItem_(a);c=null}}var b=c?c.value:null;if(b){this.stats_.hits++;this.log_("Cache HIT for key "+a)}else{this.stats_.misses++;this.log_("Cache MISS for key "+a)}return b};Cache._CacheItem=function(b,a,c){if(!b){throw new Error("key cannot be null or empty")}this.key=b;this.value=a;c=c||{};if(c.expirationAbsolute){c.expirationAbsolute=c.expirationAbsolute.getTime()}if(!c.priority){c.priority=CachePriority.NORMAL}this.options=c;this.lastAccessed=new Date().getTime()};Cache.prototype.setItem=function(b,d,a){if(this.items_.get(b)!=null){this.removeItem_(b)}this.addItem_(new Cache._CacheItem(b,d,a));this.log_("Setting key "+b);if((this.maxSize_>0)&&(this.count_>this.maxSize_)){var c=this;setTimeout(function(){c.purge_.call(c)},0)}};Cache.prototype.clear=function(){var b=this.items_.keys();for(var a=0;a<b.length;a++){this.removeItem_(b[a])}this.log_("Cache cleared")};Cache.prototype.getStats=function(){return this.stats_};Cache.prototype.toHtmlString=function(){var b=this.count_+" item(s) in cache<br /><ul>";var d=this.items_.keys();for(var a=0;a<d.length;a++){var c=this.items_.get(d[a]);b=b+"<li>"+c.key.toString()+" = "+c.value.toString()+"</li>"}b=b+"</ul>";return b};Cache.prototype.resize=function(a){this.log_("Resizing Cache from "+this.maxSize_+" to "+a);var b=this.maxSize_;this.maxSize_=a;if(a>0&&(b<0||a<b)){if(this.count_>a){this.purge_()}}this.log_("Resizing done")};Cache.prototype.purge_=function(){var g=new Array();var c=Math.round(this.maxSize_*this.fillFactor_);if(this.maxSize_<0){c=this.count_*this.fillFactor_}var e=this.items_.keys();for(var b=0;b<e.length;b++){var a=e[b];var d=this.items_.get(a);if(this.isExpired_(d)){this.removeItem_(a)}else{g.push(d)}}if(g.length>c){g=g.sort(function(i,h){if(i.options.priority!=h.options.priority){return h.options.priority-i.options.priority}else{return h.lastAccessed-i.lastAccessed}});while(g.length>c){var f=g.pop();this.removeItem_(f.key)}}this.log_("Purged cached")};Cache.prototype.addItem_=function(c,d){var a=this;try{this.items_.set(c.key,c);this.count_++}catch(b){if(d){this.log_("Failed setting again, giving up: "+b.toString());throw (b)}this.log_("Error adding item, purging and trying again: "+b.toString());this.purge_();this.addItem_(c,true)}};Cache.prototype.removeItem_=function(a){var b=this.items_.remove(a);this.count_--;this.log_("removed key "+a);if(b.options.callback!=null){setTimeout(function(){b.options.callback.call(null,b.key,b.value)},0)}};Cache.prototype.isExpired_=function(c){var a=new Date().getTime();var b=false;if(c.options.expirationAbsolute&&(c.options.expirationAbsolute<a)){b=true}if(!b&&c.options.expirationSliding){var d=c.lastAccessed+(c.options.expirationSliding*1000);if(d<a){b=true}}return b};Cache.prototype.log_=function(a){if(this.debug_){console.log(a)}};if(typeof module!=="undefined"){module.exports=Cache}jws.APIPlugInClass={NS:jws.NS_BASE+".plugins.api",ID:"api",hasPlugIn:function(d,c){var b={ns:jws.APIPlugInClass.NS,type:"hasPlugIn",plugin_id:d};var a={};if(c){if(c.OnResponse){a.OnResponse=c.OnResponse}}this.conn.sendToken(b,a)},getPlugInAPI:function(d,c){var b={ns:jws.APIPlugInClass.NS,type:"getPlugInAPI",plugin_id:d};var a={};if(c){if(c.OnResponse){a.OnResponse=c.OnResponse}}this.conn.sendToken(b,a)},supportsToken:function(d,c){var b={ns:jws.APIPlugInClass.NS,type:"supportsToken",token_type:d};var a={};if(c){if(c.OnResponse){a.OnResponse=c.OnResponse}}this.conn.sendToken(b,a)},getServerAPI:function(c){var b={ns:jws.APIPlugInClass.NS,type:"getServerAPI"};var a={};if(c){if(c.OnResponse){a.OnResponse=c.OnResponse}}this.conn.sendToken(b,a)},getPlugInsIds:function(c){var b={ns:jws.APIPlugInClass.NS,type:"getPlugInIds"};var a={};if(c){if(c.OnResponse){a.OnResponse=c.OnResponse}}this.conn.sendToken(b,a)},createSpecFromAPI:function(b,d){var e=d.supportedTokens.length;var g=[];for(var a=0;a<e;a++){var c=d.supportedTokens[a];c.ns=d.namespace;var f=function(){var k=false;var j={ns:c.ns,type:c.type};var h=c.inArguments;for(var m=0,i=h.length;m<i;m++){var l=h[m];j[l.name]=l.testValue}console.log("Automatically sending "+JSON.stringify(j));b.sendToken(j,{OnResponse:function(n){console.log("Received auto response: "+JSON.stringify(n));k=true}});waitsFor(function(){return k==true},"test",20000);runs(function(){expect(k).toEqual(true)})};g.push(f)}return g}};jws.APIPlugIn=function(){};jws.APIPlugIn.prototype=jws.APIPlugInClass;jws.ChannelPlugIn={NS:jws.NS_BASE+".plugins.channels",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",GET_CHANNELS:"getChannels",CREATE_CHANNEL:"createChannel",REMOVE_CHANNEL:"removeChannel",GET_SUBSCRIBERS:"getSubscribers",GET_SUBSCRIPTIONS:"getSubscriptions",AUTHORIZE:"authorize",PUBLISH:"publish",STOP:"stop",processToken:function(a){if(a.ns==jws.ChannelPlugIn.NS){if("event"==a.type){if("channelCreated"==a.name){if(this.fOnChannelCreated){this.fOnChannelCreated(a)}}else{if("channelRemoved"==a.name){if(this.fOnChannelRemoved){this.fOnChannelRemoved(a)}}}}else{if("getChannels"==a.reqType){if(this.fOnChannelsReceived){this.fOnChannelsReceived(a)}}}}},channelSubscribe:function(d,c,b){var a=this.checkConnected();if(0==a.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.SUBSCRIBE,channel:d,accessKey:c},b)}return a},channelUnsubscribe:function(c,b){var a=this.checkConnected();if(0==a.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.UNSUBSCRIBE,channel:c},b)}return a},channelAuth:function(e,d,a,c){var b=this.checkConnected();if(0==b.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.AUTHORIZE,channel:e,accessKey:d,secretKey:a},c)}return b},channelPublish:function(d,a,c){var b=this.checkConnected();if(0==b.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.PUBLISH,channel:d,data:a},c)}return b},channelCreate:function(e,j,b){var h=this.checkConnected();if(0==h.code){var c=false;var f=false;var g=null;var i=null;var a=null;var d=null;if(b){if(b.isPrivate!=undefined){c=b.isPrivate}if(b.isSystem!=undefined){f=b.isSystem}if(b.accessKey!=undefined){g=b.accessKey}if(b.secretKey!=undefined){i=b.secretKey}if(b.owner!=undefined){a=b.owner}if(b.password!=undefined){d=b.password}}this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.CREATE_CHANNEL,channel:e,name:j,isPrivate:c,isSystem:f,accessKey:g,secretKey:i,owner:a,password:d},b)}return h},channelRemove:function(f,e){var c=this.checkConnected();if(0==c.code){var b=null;var a=null;var g=null;var d=null;if(e){if(e.accessKey!=undefined){b=e.accessKey}if(e.secretKey!=undefined){a=e.secretKey}if(e.owner!=undefined){g=e.owner}if(e.password!=undefined){d=e.password}}this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.REMOVE_CHANNEL,channel:f,accessKey:b,secretKey:a,owner:g,password:d},e)}return c},channelGetSubscribers:function(d,c,b){var a=this.checkConnected();if(0==a.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.GET_SUBSCRIBERS,channel:d,accessKey:c},b)}return a},channelGetSubscriptions:function(b){var a=this.checkConnected();if(0==a.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.GET_SUBSCRIPTIONS},b)}return a},channelGetIds:function(b){var a=this.checkConnected();if(0==a.code){this.sendToken({ns:jws.ChannelPlugIn.NS,type:jws.ChannelPlugIn.GET_CHANNELS},b)}return a},setChannelCallbacks:function(a){if(!a){a={}}if(a.OnChannelCreated!==undefined){this.fOnChannelCreated=a.OnChannelCreated}if(a.OnChannelsReceived!==undefined){this.fOnChannelsReceived=a.OnChannelsReceived}if(a.OnChannelRemoved!==undefined){this.fOnChannelRemoved=a.OnChannelRemoved}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.ChannelPlugIn);jws.CanvasPlugIn={NS:jws.NS_BASE+".plugins.canvas",processToken:function(a){if(a.reqNS==jws.CanvasPlugIn.NS){if("clear"==a.reqType){this.doClear(a.id)}else{if("beginPath"==a.reqType){this.doBeginPath(a.id)}else{if("moveTo"==a.reqType){this.doMoveTo(a.id,a.x,a.y)}else{if("lineTo"==a.reqType){this.doLineTo(a.id,a.x,a.y)}else{if("line"==a.reqType){this.doLine(a.id,a.x1,a.y1,a.x2,a.y2,{color:a.color})}else{if("closePath"==a.reqType){this.doClosePath(a.id)}}}}}}}},fCanvas:{},canvasOpen:function(c,b){var a=jws.$(b);this.fCanvas[c]={fDOMElem:a,ctx:a.getContext("2d")}},canvasClose:function(a){this.fCanvas[a]=null;delete this.fCanvas[a]},doClear:function(d){var c=this.fCanvas[d];if(c!=null){var b=c.fDOMElem.getAttribute("width");var a=c.fDOMElem.getAttribute("height");c.ctx.clearRect(0,0,b,a);return true}return false},canvasClear:function(b){if(this.doClear(b)){var a={reqNS:jws.CanvasPlugIn.NS,reqType:"clear",id:b};this.broadcastToken(a)}},canvasGetBase64:function(d,c){var a={code:-1,msg:"Ok"};var b=this.fCanvas[d];if(b!=null){if(typeof b.fDOMElem.toDataURL=="function"){a.code=0;a.encoding="base64";a.data=b.fDOMElem.toDataURL(c)}else{a.msg="Retrieving image data from canvas not (yet) supported by browser."}}else{a.msg="Canvas not found."}return a},doBeginPath:function(b){var a=this.fCanvas[b];if(a!=null){a.ctx.beginPath();return true}return false},canvasBeginPath:function(b){if(this.doBeginPath(b)){var a={reqNS:jws.CanvasPlugIn.NS,reqType:"beginPath",id:b};this.broadcastToken(a)}},doMoveTo:function(d,b,a){var c=this.fCanvas[d];if(c!=null){c.ctx.moveTo(b,a);return true}return false},canvasMoveTo:function(d,c,b){if(this.doMoveTo(d,c,b)){var a={reqNS:jws.CanvasPlugIn.NS,reqType:"moveTo",id:d,x:c,y:b};this.broadcastToken(a)}},doLineTo:function(d,b,a){var c=this.fCanvas[d];if(c!=null){c.ctx.lineTo(b,a);c.ctx.stroke();return true}return false},canvasLineTo:function(d,c,b){if(this.doLineTo(d,c,b)){var a={reqNS:jws.CanvasPlugIn.NS,reqType:"lineTo",id:d,x:c,y:b};this.broadcastToken(a)}},doLine:function(h,c,e,b,d,f){if(undefined==f){f={}}var a="black";if(f.color){a=f.color}var g=this.fCanvas[h];if(g!=null){g.ctx.beginPath();g.ctx.moveTo(c,e);g.ctx.strokeStyle=a;g.ctx.lineTo(b,d);g.ctx.stroke();g.ctx.closePath();return true}return false},canvasLine:function(h,c,f,b,e,g){if(undefined==g){g={}}var a="black";if(g.color){a=g.color}if(this.doLine(h,c,f,b,e,g)){var d={reqNS:jws.CanvasPlugIn.NS,reqType:"line",id:h,x1:c,y1:f,x2:b,y2:e,color:a};this.broadcastToken(d)}},doClosePath:function(b){var a=this.fCanvas[b];if(a!=null){a.ctx.closePath();return true}return false},canvasClosePath:function(b){if(this.doClosePath(b)){var a={reqNS:jws.CanvasPlugIn.NS,reqType:"closePath",id:b};this.broadcastToken(a)}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.CanvasPlugIn);if(jws.isIE){document.createElement("canvas").getContext||(function(){var J=Math,ab=J.round,z=J.sin,w=J.cos,e=J.abs,d=J.sqrt,T=10,x=T/2;function c(){return this.context_||(this.context_=new u(this))}var q=Array.prototype.slice;function b(i,j){var k=q.call(arguments,2);return function(){return i.apply(j,k.concat(q.call(arguments)))}}var p={init:function(i){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var j=i||document;j.createElement("canvas");j.attachEvent("onreadystatechange",b(this.init_,this,j))}},init_:function(i){i.namespaces.g_vml_||i.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");i.namespaces.g_o_||i.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!i.styleSheets.ex_canvas_){var j=i.createStyleSheet();j.owningElement.id="ex_canvas_";j.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var s=i.getElementsByTagName("canvas"),k=0;for(;k<s.length;k++){this.initElement(s[k])}},initElement:function(i){if(!i.getContext){i.getContext=c;i.innerHTML="";i.attachEvent("onpropertychange",a);i.attachEvent("onresize",g);var j=i.attributes;if(j.width&&j.width.specified){i.style.width=j.width.nodeValue+"px"}else{i.width=i.clientWidth}if(j.height&&j.height.specified){i.style.height=j.height.nodeValue+"px"}else{i.height=i.clientHeight}}return i}};function a(i){var j=i.srcElement;switch(i.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function g(i){var j=i.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}p.init();var o=[],R=0;for(;R<16;R++){var K=0;for(;K<16;K++){o[R*16+K]=R.toString(16)+K.toString(16)}}function t(){return[[1,0,0],[0,1,0],[0,0,1]]}function r(i,j){var A=t(),y=0;for(;y<3;y++){var v=0;for(;v<3;v++){var k=0,s=0;for(;s<3;s++){k+=i[y][s]*j[s][v]}A[y][v]=k}}return A}function m(i,j){j.fillStyle=i.fillStyle;j.lineCap=i.lineCap;j.lineJoin=i.lineJoin;j.lineWidth=i.lineWidth;j.miterLimit=i.miterLimit;j.shadowBlur=i.shadowBlur;j.shadowColor=i.shadowColor;j.shadowOffsetX=i.shadowOffsetX;j.shadowOffsetY=i.shadowOffsetY;j.strokeStyle=i.strokeStyle;j.globalAlpha=i.globalAlpha;j.arcScaleX_=i.arcScaleX_;j.arcScaleY_=i.arcScaleY_;j.lineScale_=i.lineScale_}function l(i){var j,A=1;i=String(i);if(i.substring(0,3)=="rgb"){var y=i.indexOf("(",3),v=i.indexOf(")",y+1),k=i.substring(y+1,v).split(",");j="#";var s=0;for(;s<3;s++){j+=o[Number(k[s])]}if(k.length==4&&i.substr(3,1)=="a"){A=k[3]}}else{j=i}return{color:j,alpha:A}}function ad(i){switch(i){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function u(i){this.m_=t();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=T*1;this.globalAlpha=1;this.canvas=i;var j=i.ownerDocument.createElement("div");j.style.width=i.clientWidth+"px";j.style.height=i.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";i.appendChild(j);this.element_=j;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}var ac=u.prototype;ac.clearRect=function(){this.element_.innerHTML=""};ac.beginPath=function(){this.currentPath_=[]};ac.moveTo=function(i,j){var k=this.getCoords_(i,j);this.currentPath_.push({type:"moveTo",x:k.x,y:k.y});this.currentX_=k.x;this.currentY_=k.y};ac.lineTo=function(i,j){var k=this.getCoords_(i,j);this.currentPath_.push({type:"lineTo",x:k.x,y:k.y});this.currentX_=k.x;this.currentY_=k.y};ac.bezierCurveTo=function(B,C,A,y,s,j){var k=this.getCoords_(s,j),i=this.getCoords_(B,C),v=this.getCoords_(A,y);h(this,i,v,k)};function h(i,j,s,k){i.currentPath_.push({type:"bezierCurveTo",cp1x:j.x,cp1y:j.y,cp2x:s.x,cp2y:s.y,x:k.x,y:k.y});i.currentX_=k.x;i.currentY_=k.y}ac.quadraticCurveTo=function(i,j,A,y){var v=this.getCoords_(i,j),k=this.getCoords_(A,y),s={x:this.currentX_+0.6666666666666666*(v.x-this.currentX_),y:this.currentY_+0.6666666666666666*(v.y-this.currentY_)};h(this,s,{x:s.x+(k.x-this.currentX_)/3,y:s.y+(k.y-this.currentY_)/3},k)};ac.arc=function(H,I,G,F,C,A){G*=T;var B=A?"at":"wa",y=H+w(F)*G-x,D=I+z(F)*G-x,v=H+w(C)*G-x,i=I+z(C)*G-x;if(y==v&&!A){y+=0.125}var s=this.getCoords_(H,I),k=this.getCoords_(y,D),j=this.getCoords_(v,i);this.currentPath_.push({type:B,x:s.x,y:s.y,radius:G,xStart:k.x,yStart:k.y,xEnd:j.x,yEnd:j.y})};ac.rect=function(i,j,s,k){this.moveTo(i,j);this.lineTo(i+s,j);this.lineTo(i+s,j+k);this.lineTo(i,j+k);this.closePath()};ac.strokeRect=function(i,j,v,s){var k=this.currentPath_;this.beginPath();this.moveTo(i,j);this.lineTo(i+v,j);this.lineTo(i+v,j+s);this.lineTo(i,j+s);this.closePath();this.stroke();this.currentPath_=k};ac.fillRect=function(i,j,v,s){var k=this.currentPath_;this.beginPath();this.moveTo(i,j);this.lineTo(i+v,j);this.lineTo(i+v,j+s);this.lineTo(i,j+s);this.closePath();this.fill();this.currentPath_=k};ac.createLinearGradient=function(i,j,v,s){var k=new E("gradient");k.x0_=i;k.y0_=j;k.x1_=v;k.y1_=s;return k};ac.createRadialGradient=function(i,j,A,y,v,k){var s=new E("gradientradial");s.x0_=i;s.y0_=j;s.r0_=A;s.x1_=y;s.y1_=v;s.r1_=k;return s};ac.drawImage=function(P){var Q,O,N,L,H,I,G,M,F=P.runtimeStyle.width,y=P.runtimeStyle.height;P.runtimeStyle.width="auto";P.runtimeStyle.height="auto";var D=P.width,C=P.height;P.runtimeStyle.width=F;P.runtimeStyle.height=y;if(arguments.length==3){Q=arguments[1];O=arguments[2];H=I=0;G=N=D;M=L=C}else{if(arguments.length==5){Q=arguments[1];O=arguments[2];N=arguments[3];L=arguments[4];H=I=0;G=D;M=C}else{if(arguments.length==9){H=arguments[1];I=arguments[2];G=arguments[3];M=arguments[4];Q=arguments[5];O=arguments[6];N=arguments[7];L=arguments[8]}else{throw Error("Invalid number of arguments")}}}var A=this.getCoords_(Q,O),v=[];v.push(" <g_vml_:group",' coordsize="',T*10,",",T*10,'"',' coordorigin="0,0"',' style="width:',10,"px;height:",10,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var s=[];s.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",ab(A.x/T),",","Dy=",ab(A.y/T),"");var B=A,i=this.getCoords_(Q+N,O),k=this.getCoords_(Q,O+L),j=this.getCoords_(Q+N,O+L);B.x=J.max(B.x,i.x,k.x,j.x);B.y=J.max(B.y,i.y,k.y,j.y);v.push("padding:0 ",ab(B.x/T),"px ",ab(B.y/T),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",s.join(""),", sizingmethod='clip');")}else{v.push("top:",ab(A.y/T),"px;left:",ab(A.x/T),"px;")}v.push(' ">','<g_vml_:image src="',P.src,'"',' style="width:',T*N,"px;"," height:",T*L,'px;"',' cropleft="',H/D,'"',' croptop="',I/C,'"',' cropright="',(D-H-G)/D,'"',' cropbottom="',(C-I-M)/C,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",v.join(""))};ac.stroke=function(aa){var ae=[],Z=l(aa?this.fillStyle:this.strokeStyle),Y=Z.color,W=Z.alpha*this.globalAlpha;ae.push("<g_vml_:shape",' filled="',!!aa,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',T*10," ",T*10,'"',' stroked="',!aa,'"',' path="');var U={x:null,y:null},V={x:null,y:null},Q=0;for(;Q<this.currentPath_.length;Q++){var X=this.currentPath_[Q];switch(X.type){case"moveTo":ae.push(" m ",ab(X.x),",",ab(X.y));break;case"lineTo":ae.push(" l ",ab(X.x),",",ab(X.y));break;case"close":ae.push(" x ");X=null;break;case"bezierCurveTo":ae.push(" c ",ab(X.cp1x),",",ab(X.cp1y),",",ab(X.cp2x),",",ab(X.cp2y),",",ab(X.x),",",ab(X.y));break;case"at":case"wa":ae.push(" ",X.type," ",ab(X.x-this.arcScaleX_*X.radius),",",ab(X.y-this.arcScaleY_*X.radius)," ",ab(X.x+this.arcScaleX_*X.radius),",",ab(X.y+this.arcScaleY_*X.radius)," ",ab(X.xStart),",",ab(X.yStart)," ",ab(X.xEnd),",",ab(X.yEnd));break}if(X){if(U.x==null||X.x<U.x){U.x=X.x}if(V.x==null||X.x>V.x){V.x=X.x}if(U.y==null||X.y<U.y){U.y=X.y}if(V.y==null||X.y>V.y){V.y=X.y}}}ae.push(' ">');if(aa){if(typeof this.fillStyle=="object"){var P=this.fillStyle,H=0,O={x:0,y:0},M=0,I=1;if(P.type_=="gradient"){var G=P.x1_/this.arcScaleX_,F=P.y1_/this.arcScaleY_,L=this.getCoords_(P.x0_/this.arcScaleX_,P.y0_/this.arcScaleY_),y=this.getCoords_(G,F);H=Math.atan2(y.x-L.x,y.y-L.y)*180/Math.PI;if(H<0){H+=360}if(H<0.000001){H=0}}else{var L=this.getCoords_(P.x0_,P.y0_),C=V.x-U.x,B=V.y-U.y;O={x:(L.x-U.x)/C,y:(L.y-U.y)/B};C/=this.arcScaleX_*T;B/=this.arcScaleY_*T;var k=J.max(C,B);M=2*P.r0_/k;I=2*P.r1_/k-M}var D=P.colors_;D.sort(function(ai,ah){return ai.offset-ah.offset});var A=D.length,af=D[0].color,s=D[A-1].color,N=D[0].alpha*this.globalAlpha,ag=D[A-1].alpha*this.globalAlpha,j=[],Q=0;for(;Q<A;Q++){var i=D[Q];j.push(i.offset*I+M+" "+i.color)}ae.push('<g_vml_:fill type="',P.type_,'"',' method="none" focus="100%"',' color="',af,'"',' color2="',s,'"',' colors="',j.join(","),'"',' opacity="',ag,'"',' g_o_:opacity2="',N,'"',' angle="',H,'"',' focusposition="',O.x,",",O.y,'" />')}else{ae.push('<g_vml_:fill color="',Y,'" opacity="',W,'" />')}}else{var v=this.lineScale_*this.lineWidth;if(v<1){W*=v}ae.push("<g_vml_:stroke",' opacity="',W,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',ad(this.lineCap),'"',' weight="',v,'px"',' color="',Y,'" />')}ae.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",ae.join(""))};ac.fill=function(){this.stroke(true)};ac.closePath=function(){this.currentPath_.push({type:"close"})};ac.getCoords_=function(i,j){var k=this.m_;return{x:T*(i*k[0][0]+j*k[1][0]+k[2][0])-x,y:T*(i*k[0][1]+j*k[1][1]+k[2][1])-x}};ac.save=function(){var i={};m(this,i);this.aStack_.push(i);this.mStack_.push(this.m_);this.m_=r(t(),this.m_)};ac.restore=function(){m(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function n(i){var j=0;for(;j<3;j++){var k=0;for(;k<2;k++){if(!isFinite(i[j][k])||isNaN(i[j][k])){return false}}}return true}function S(i,j,k){if(!!n(j)){i.m_=j;if(k){i.lineScale_=d(e(j[0][0]*j[1][1]-j[0][1]*j[1][0]))}}}ac.translate=function(i,j){S(this,r([[1,0,0],[0,1,0],[i,j,1]],this.m_),false)};ac.rotate=function(i){var j=w(i),k=z(i);S(this,r([[j,k,0],[-k,j,0],[0,0,1]],this.m_),false)};ac.scale=function(i,j){this.arcScaleX_*=i;this.arcScaleY_*=j;S(this,r([[i,0,0],[0,j,0],[0,0,1]],this.m_),true)};ac.transform=function(i,j,y,v,s,k){S(this,r([[i,j,0],[y,v,0],[s,k,1]],this.m_),true)};ac.setTransform=function(i,j,y,v,s,k){S(this,[[i,j,0],[y,v,0],[s,k,1]],true)};ac.clip=function(){};ac.arcTo=function(){};ac.createPattern=function(){return new f};function E(i){this.type_=i;this.r1_=this.y1_=this.x1_=this.r0_=this.y0_=this.x0_=0;this.colors_=[]}E.prototype.addColorStop=function(i,j){j=l(j);this.colors_.push({offset:i,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=p;CanvasRenderingContext2D=u;CanvasGradient=E;CanvasPattern=f})()}jws.ChatPlugIn={NS:jws.NS_BASE+".plugins.chat",processToken:function(a){if(a.ns==jws.ChatPlugIn.NS){if("login"==a.reqType){if(this.onChatRequestToken){this.onChatRequestToken(a)}}}},ChatLogin:function(a,c,f,h,d,g){var e=this.checkConnected();if(0==e.code){var b={ns:jws.ChatPlugIn.NS,type:"login",username:a,password:c,server:f,port:h,useSSL:d};this.sendToken(b,g)}return e},ChatLogout:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.ChatPlugIn.NS,type:"logout"};this.sendToken(a,c)}return b},setChatCallbacks:function(a){if(!a){a={}}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.ChatPlugIn);jws.ClientGamingPlugIn={NS:jws.NS_BASE+".plugins.clientGaming",fIsActive:false,setActive:function(a){if(a){}else{}jws.ClientGamingPlugIn.fIsActive=a},isActive:function(){return jws.ClientGamingPlugIn.fIsActive},addPlayer:function(d,c,b){d="player"+d;var a=document.getElementById(d);if(!a){a=document.createElement("div")}a.id=d;a.style.position="absolute";a.style.overflow="hidden";a.style.opacity=0.85;a.style.left="100px";a.style.top="100px";a.style.width="75px";a.style.height="75px";a.style.border="1px solid black";a.style.background="url(img/player_"+b+".png) 15px 18px no-repeat";a.style.backgroundColor=b;a.style.color="white";a.innerHTML='<font style="font-size:8pt">Player '+c+"</font>";document.body.appendChild(a);if(!this.fPlayers){this.fPlayers={}}this.fPlayers[d]=a},removeAllPlayers:function(){if(this.fPlayers){for(var a in this.fPlayers){document.body.removeChild(this.fPlayers[a])}}delete this.fPlayers},removePlayer:function(b){b="player"+b;var a=document.getElementById(b);if(a){document.body.removeChild(a);if(this.fPlayers){delete this.fPlayers[b]}}},movePlayer:function(d,c,b){d="player"+d;var a=document.getElementById(d);if(a){a.style.left=c+"px";a.style.top=b+"px"}},processOpened:function(a){if(this.isActive()){this.addPlayer(a.sourceId,a.sourceId,"green");a.ns=jws.SystemClientPlugIn.NS;a.type="broadcast";a.request="identify";this.sendToken(a)}},processClosed:function(a){if(this.isActive()){this.removeAllPlayers()}},processConnected:function(a){if(this.isActive()){this.addPlayer(a.sourceId,a.sourceId,"red")}},processDisconnected:function(a){if(this.isActive()){this.removePlayer(a.sourceId)}},processToken:function(c){if(c.ns==jws.SystemClientPlugIn.NS){var e,d;if(c.event=="move"){e=c.x;d=c.y;this.movePlayer(c.sourceId,e,d)}else{if(c.event=="identification"){this.addPlayer(c.sourceId,c.sourceId,"red");e=c.x;d=c.y;this.movePlayer(c.sourceId,e,d)}else{if(c.request=="identify"){var a=document.getElementById("player"+this.getId());e=100;d=100;if(a){e=parseInt(a.style.left);d=parseInt(a.style.top)}var b={ns:jws.SystemClientPlugIn.NS,type:"broadcast",event:"identification",x:e,y:d,username:this.getUsername()};this.sendToken(b)}}}}},broadcastGamingEvent:function(a,c){var b=this.checkConnected();if(b.code==0){a.ns=jws.SystemClientPlugIn.NS;a.type="broadcast";a.event="move";a.senderIncluded=true;a.responseRequested=false;a.username=this.getUsername();this.sendToken(a,c)}return b}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.ClientGamingPlugIn);jws.oop.declareClass("jws","EventsCallbacksHandler",null,{OnTimeout:function(a,b){if(undefined!=b.meta.OnTimeout){b.meta.OnTimeout(a)}},OnResponse:function(d,c){d.elapsedTime=(new Date().getTime())-c.sentTime;d.processingTime=d._pt;delete (d._pt);if(undefined!=c.meta.eventDefinition){var a=c.filterChain.length-1;while(a>-1){try{c.filterChain[a].afterCall(c.meta,d)}catch(b){switch(b){case"stop_filter_chain":return;break;default:throw b;break}}a--}}if(undefined!=c.meta.OnResponse){c.meta.OnResponse(d)}if(d.code===0){if(undefined!=c.meta.OnSuccess){c.meta.OnSuccess(d)}}else{if(undefined!=c.meta.OnFailure){c.meta.OnFailure(d)}}}});jws.oop.declareClass("jws","EventsNotifier",null,{ID:"",jwsClient:{},NS:"",filterChain:[],plugIns:[],initialize:function(){this.jwsClient.addPlugIn(this);for(var a=0,b=this.filterChain.length;a<b;a++){if(this.filterChain[a]["initialize"]){this.filterChain[a].initialize(this)}}},notify:function(c,f){if(this.jwsClient.isConnected()){var a={};if(f.args){a=f.args;delete (f.args)}a.ns=this.NS;a.type=c;f.UTID=jws.tools.generateSharedUTID(a);var e;if(!f.OnResponse&&!f.OnSuccess&&!f.OnFailure&&!f.OnTimeout){e={}}else{e=new jws.EventsCallbacksHandler()}e.args={meta:f,filterChain:this.filterChain,sentTime:new Date().getTime()};if(undefined!=f.eventDefinition){for(var b=0;b<this.filterChain.length;b++){try{this.filterChain[b].beforeCall(a,e)}catch(d){switch(d){case"stop_filter_chain":return;break;default:throw d;break}}}}this.jwsClient.sendToken(a,e)}else{throw"client:not_connected"}},processToken:function(b){if(this.NS==b.ns&&"s2c.en"==b.type){var d=b._e;var a=b._p;if(undefined!=this.plugIns[a]&&undefined!=this.plugIns[a][d]){var c=new Date().getTime();var e=this.plugIns[a][d](b);var f=(new Date().getTime())-c;if(b.hc){this.notify("s2c.r",{args:{_rid:b.uid,_r:e,_pt:f}})}}else{this.notify("s2c.ens",{args:{_rid:b.uid}});throw"s2c_event_support_not_found for: "+d}}}});jws.oop.declareClass("jws","EventsPlugInGenerator",null,{generate:function(aPlugInId,aNotifier,OnReady){var lPlugIn=new jws.EventsPlugIn();lPlugIn.notifier=aNotifier;aNotifier.notify("plugin.getapi",{args:{plugin_id:aPlugInId},plugIn:lPlugIn,OnReady:OnReady,OnSuccess:function(aResponseEvent){this.plugIn.id=aResponseEvent.id;this.plugIn.plugInAPI=aResponseEvent.api;for(method in aResponseEvent.api){eval("this.plugIn."+method+"=function(aOptions){if (undefined == aOptions){aOptions = {};};var eventName=this.plugInAPI."+method+".type; aOptions.eventDefinition=this.plugInAPI."+method+"; aOptions.timeout = this.plugInAPI."+method+".timeout; this.notifier.notify(eventName, aOptions);}")}this.plugIn.notifier.plugIns[this.plugIn.id]=this.plugIn;this.OnReady(this.plugIn)},OnFailure:function(aResponseEvent){throw aResponseEvent.msg}});return lPlugIn}});jws.oop.declareClass("jws","EventsPlugIn",null,{id:"",notifier:{},plugInAPI:{}});jws.oop.declareClass("jws","AppUser",null,{principal:"",uuid:"",roles:[],clear:function(){this.principal="";this.roles=[];this.uuid=""},isAuthenticated:function(){return(this.principal)?true:false},hasRole:function(c){var b=this.roles.length;for(var a=0;a<b;a++){if(c==this.roles[a]){return true}}return false}});jws.oop.declareClass("jws","EventsBaseFilter",null,{id:"",initialize:function(a){},beforeCall:function(b,a){},afterCall:function(a,b){}});jws.oop.declareClass("jws","SecurityFilter",jws.EventsBaseFilter,{id:"security",initialize:function(a){jws.user=new jws.AppUser()},beforeCall:function(p,o){if(o.args.meta.eventDefinition.isSecurityEnabled){var q,n;var e,a=null;var m=false;var l=false;var b=false;var h=false;a=o.args.meta.eventDefinition.users;e=o.args.meta.eventDefinition.roles;if(a&&e&&!jws.user.isAuthenticated()){if(o.OnResponse){o.OnResponse({code:-2,msg:"User is not authenticated yet. Login first!"},o.args)}this.OnNotAuthorized(p);throw"stop_filter_chain"}if(a.length>0){var g=false;for(var c=0;c<a.length;c++){n=a[c];if("all"!=n){m=(n.substring(0,1)=="!")?true:false;n=(m)?n.substring(1):n;if(n==jws.user.principal){g=true;if(!m){b=true}break}}else{g=true;b=true;break}}if(!b&&g||0==e.length){o.OnResponse({code:-2,msg:"Not autorized to notify this event. USER restrictions: "+a.toString()},o.args);this.OnNotAuthorized(p);throw"stop_filter_chain"}}if(e.length>0){for(var f=0;f<e.length;f++){for(var d=0;d<jws.user.roles.length;d++){q=e[f];if("all"!=q){m=(q.substring(0,1)=="!")?true:false;q=(m)?q.substring(1):q;if(q==jws.user.roles[d]){if(!m){l=true}h=true;break}}else{l=true;h=true;break}}if(h){break}}if(!l){if(o.OnResponse){o.OnResponse({code:-2,msg:"Not autorized to notify this event. ROLE restrictions: "+e.toString()},o.args)}this.OnNotAuthorized(p);throw"stop_filter_chain"}}}},OnNotAuthorized:function(a){throw"not_authorized"}});jws.oop.declareClass("jws","CacheFilter",jws.EventsBaseFilter,{id:"cache",cache:{},initialize:function(a){a.notify("clientcacheaspect.setstatus",{args:{enabled:true}});a.plugIns.__cache__={cache:this.cache,cleanEntries:function(d){for(var c=0,b=d.entries.length;c<b;c++){this.cache.removeItem_(jws.user.principal.toString()+d.suffix+d.entries[c])}}}},beforeCall:function(b,a){if(a.args.meta.eventDefinition.isCacheEnabled){var c=a.args.meta.eventDefinition.type+a.args.meta.UTID;if(a.args.meta.eventDefinition.isCachePrivate&&jws.user.isAuthenticated()){c=jws.user.uuid+c}var d=this.cache.getItem(c);if(null!=d){d.processingTime=0;a.args.meta.elapsedTime=(new Date().getTime())-a.sentTime;if(a.OnResponse){a.OnResponse(d,a.args)}throw"stop_filter_chain"}}},afterCall:function(a,c){if(a.eventDefinition.isCacheEnabled){var b=a.eventDefinition.type+a.UTID;if(a.eventDefinition.isCachePrivate){b=jws.user.uuid+b}this.cache.setItem(b,c,{expirationAbsolute:null,expirationSliding:a.eventDefinition.cacheTime,priority:CachePriority.High})}}});jws.oop.declareClass("jws","ValidatorFilter",jws.EventsBaseFilter,{id:"validator",beforeCall:function(c,b){var e=b.args.meta.eventDefinition.incomingArgsValidation;for(var d=0;d<e.length;d++){if(undefined===c[e[d].name]&&!e[d].optional){if(b.OnResponse){b.OnResponse({code:-4,msg:"Argument '"+e[d].name+"' is required!"},b.args)}throw"stop_filter_chain"}else{if(c.hasOwnProperty(e[d].name)){var f=e[d].type;var a=jws.tools.getType(c[e[d].name]);if("number"==f&&("integer"==a||"double"==a)){return}if("double"==f&&("integer"==a)){return}if(f!=a){if(b.OnResponse){b.OnResponse({code:-4,msg:"Argument '"+e[d].name+"' has invalid type. Required: '"+f+"'"},b.args)}throw"stop_filter_chain"}}}}}});jws.FileSystemPlugIn={NS:jws.NS_BASE+".plugins.filesystem",NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8,INVALID_MODIFICATION_ERR:9,QUOTA_EXCEEDED_ERR:10,TYPE_MISMATCH_ERR:11,PATH_EXISTS_ERR:12,processToken:function(a){if(a.ns==jws.FileSystemPlugIn.NS){if("load"==a.reqType){if(a.code==0){a.data=Base64.decode(a.data);if(this.OnFileLoaded){this.OnFileLoaded(a)}}else{if(this.OnFileError){this.OnFileError(a)}}}else{if("event"==a.type){if("filesaved"==a.name){if(this.OnFileSaved){this.OnFileSaved(a)}}else{if("filesent"==a.name){if(this.OnFileSent){this.OnFileSent(a)}}}}}}},fileGetFilelist:function(d,a,g){var f=this.checkConnected();if(0==f.code){var e=jws.SCOPE_PRIVATE;var c=false;if(g){if(g.scope!=undefined){e=g.scope}if(g.recursive!=undefined){c=g.recursive}}var b={ns:jws.FileSystemPlugIn.NS,type:"getFilelist",alias:d,recursive:c,scope:e,filemasks:a};this.sendToken(b,g)}return f},fileLoad:function(c,e){var d=this.createDefaultResult();var b=jws.SCOPE_PRIVATE;if(e){if(e.scope!=undefined){b=e.scope}}if(this.isConnected()){var a={ns:jws.FileSystemPlugIn.NS,type:"load",scope:b,filename:c};this.sendToken(a,e)}else{d.code=-1;d.localeKey="jws.jsc.res.notConnected";d.msg="Not connected."}return d},fileSave:function(d,b,f){var e=this.createDefaultResult();var h="base64";var g=false;var c=jws.SCOPE_PRIVATE;if(f){if(f.scope!=undefined){c=f.scope}if(f.encoding!=undefined){h=f.encoding}if(f.suppressEncoder!=undefined){g=f.suppressEncoder}}if(!g){if(h=="base64"){b=Base64.encode(b)}}if(this.isConnected()){var a={ns:jws.FileSystemPlugIn.NS,type:"save",scope:c,encoding:h,notify:true,data:b,filename:d};this.sendToken(a,f)}else{e.code=-1;e.localeKey="jws.jsc.res.notConnected";e.msg="Not connected."}return e},fileSend:function(e,d,c,g){var h="base64";var a=false;if(g){if(g.encoding!=undefined){h=g.encoding}if(g.isNode!=undefined){a=g.isNode}}var f=this.checkConnected();if(0==f.code){var b={ns:jws.FileSystemPlugIn.NS,type:"send",data:c,encoding:h,filename:d};if(a){b.unid=e}else{b.targetId=e}this.sendToken(b)}return f},fileGetErrorMsg:function(b){var a="unkown";switch(b){case jws.FileSystemPlugIn.NOT_FOUND_ERR:a="NOT_FOUND_ERR";break;case jws.FileSystemPlugIn.SECURITY_ERR:a="SECURITY_ERR";break;case jws.FileSystemPlugIn.ABORT_ERR:a="ABORT_ERR";break;case jws.FileSystemPlugIn.NOT_READABLE_ERR:a="NOT_READABLE_ERR";break;case jws.FileSystemPlugIn.ENCODING_ERR:a="ENCODING_ERR";break;case jws.FileSystemPlugIn.NO_MODIFICATION_ALLOWED_ERR:a="NO_MODIFICATION_ALLOWED_ERR";break;case jws.FileSystemPlugIn.INVALID_STATE_ERR:a="INVALID_STATE_ERR";break;case jws.FileSystemPlugIn.SYNTAX_ERR:a="SYNTAX_ERR";break;case jws.FileSystemPlugIn.INVALID_MODIFICATION_ERR:a="INVALID_MODIFICATION_ERR";break;case jws.FileSystemPlugIn.QUOTA_EXCEEDED_ERR:a="QUOTA_EXCEEDED_ERR";break;case jws.FileSystemPlugIn.TYPE_MISMATCH_ERR:a="TYPE_MISMATCH_ERR";break;case jws.FileSystemPlugIn.PATH_EXISTS_ERR:a="PATH_EXISTS_ERR";break}return a},fileLoadLocal:function(h,a){var i={code:0,msg:"ok"};if(!h||!h.files){return{code:-1,msg:"No input file element passed."}}if(undefined==window.FileReader){return{code:-1,msg:"Your browser does not yet support the HTML5 File API."}}if(!a){a={}}if(!a.encoding){a.encoding="base64"}var g=h.files;if(!g||!g.length){return{code:-1,msg:"No files selected."}}for(var j=0,b=g.length;j<b;j++){var e=g[j];var d=new FileReader();var k=this;d.onload=(function(l){return function(n){if(k.OnLocalFileRead||a.OnSuccess){var m={encoding:a.encoding,fileName:l.fileName,fileSize:l.fileSize,type:l.type,lastModified:l.lastModifiedDate,data:n.target.result};if(a.args){m.args=a.args}if(a.action){m.action=a.action}}if(k.OnLocalFileRead){k.OnLocalFileRead(m)}if(a.OnSuccess){a.OnSuccess(m)}}})(e);d.onerror=(function(l){return function(o){if(k.OnLocalFileError||a.OnFailure){var m=o.target.error.code;var n={code:m,msg:k.fileGetErrorMsg(m)};if(a.args){n.args=a.args}if(a.action){n.action=a.action}}if(k.OnLocalFileError){k.OnLocalFileError(n)}if(a.OnFailure){a.OnFailure(n)}}})(e);try{d.readAsDataURL(e)}catch(f){if(k.OnLocalFileError||a.OnFailure){var c={code:-1,msg:f.message};if(a.args){c.args=a.args}if(a.action){c.action=a.action}}if(k.OnLocalFileError){k.OnLocalFileError(c)}if(a.OnFailure){a.OnFailure(c)}}}return i},setFileSystemCallbacks:function(a){if(!a){a={}}if(a.OnFileLoaded!==undefined){this.OnFileLoaded=a.OnFileLoaded}if(a.OnFileSaved!==undefined){this.OnFileSaved=a.OnFileSaved}if(a.OnFileSent!==undefined){this.OnFileSent=a.OnFileSent}if(a.OnFileError!==undefined){this.OnFileError=a.OnFileError}if(a.OnLocalFileRead!==undefined){this.OnLocalFileRead=a.OnLocalFileRead}if(a.OnLocalFileError!==undefined){this.OnLocalFileError=a.OnLocalFileError}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.FileSystemPlugIn);jws.JDBCPlugIn={NS:jws.NS_BASE+".plugins.jdbc",processToken:function(a){if(a.ns==jws.JDBCPlugIn.NS){if("selectSQL"==a.reqType){if(this.OnJDBCRowSet){this.OnJDBCRowSet(a)}}}},jdbcQuerySQL:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.JDBCPlugIn.NS,type:"querySQL",sql:c};this.sendToken(a,d)}return b},jdbcQueryScript:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.JDBCPlugIn.NS,type:"querySQL",script:a};this.sendToken(b,d)}return c},jdbcUpdateSQL:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.JDBCPlugIn.NS,type:"updateSQL",sql:c};this.sendToken(a,d)}return b},jdbcUpdateScript:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.JDBCPlugIn.NS,type:"updateSQL",script:a};this.sendToken(b,d)}return c},jdbcExecSQL:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.JDBCPlugIn.NS,type:"execSQL",sql:c};this.sendToken(a,d)}return b},jdbcSelect:function(e,f){var d=this.checkConnected();if(0==d.code){var h=e.tables;if(h&&!h.length){h=[h]}var c=e.fields;if(c&&!c.length){c=[c]}var g=e.joins;if(g&&!g.length){g=[g]}var a=e.orders;if(a&&!a.length){a=[a]}var b={ns:jws.JDBCPlugIn.NS,type:"select",tables:h,joins:g,fields:c,orders:a,where:e.where,group:e.group,having:e.having};this.sendToken(b,f)}return d},jdbcUpdate:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.JDBCPlugIn.NS,type:"update",table:c.table,fields:c.fields,values:c.values,where:c.where};this.sendToken(a,d)}return b},jdbcInsert:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.JDBCPlugIn.NS,type:"insert",table:c.table,fields:c.fields,values:c.values};this.sendToken(a,d)}return b},jdbcDelete:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.JDBCPlugIn.NS,type:"delete",table:c.table,where:c.where};this.sendToken(a,d)}return b},jdbcGetPrimaryKeys:function(a,e){var d=this.checkConnected();if(0==d.code){var c=1;if(e){if(e.count!=undefined){c=e.count}}var b={ns:jws.JDBCPlugIn.NS,type:"getNextSeqVal",sequence:a,count:c};this.sendToken(b,e)}return d},setJDBCCallbacks:function(a){if(!a){a={}}if(a.OnJDBCRowSet!==undefined){this.OnJDBCRowSet=a.OnJDBCRowSet}if(a.OnJDBCResult!==undefined){this.OnJDBCResult=a.OnJDBCResult}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.JDBCPlugIn);jws.JMSPlugIn={NS:jws.NS_BASE+".plugins.jms",SEND_TEXT:"sendJmsText",SEND_TEXT_MESSAGE:"sendJmsTextMessage",SEND_MAP:"sendJmsMap",SEND_MAP_MESSAGE:"sendJmsMapMessage",LISTEN:"listenJms",LISTEN_MESSAGE:"listenJmsMessage",UNLISTEN:"unlistenJms",listenJms:function(e,a,b,d){var c=this.checkConnected();if(0==c.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.LISTEN,connectionFactoryName:e,destinationName:a,pubSubDomain:b},d)}return c},listenJmsMessage:function(e,a,b,d){var c=this.checkConnected();if(0==c.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.LISTEN_MESSAGE,connectionFactoryName:e,destinationName:a,pubSubDomain:b},d)}return c},unlistenJms:function(e,a,b,d){var c=this.checkConnected();if(0==c.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.UNLISTEN,connectionFactoryName:e,destinationName:a,pubSubDomain:b},d)}return c},sendJmsText:function(f,a,c,b,e){var d=this.checkConnected();if(0==d.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.SEND_TEXT,connectionFactoryName:f,destinationName:a,pubSubDomain:c,msgPayLoad:b},e)}return d},sendJmsTextMessage:function(g,a,c,b,f,e){var d=this.checkConnected();if(0==d.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.SEND_TEXT_MESSAGE,connectionFactoryName:g,destinationName:a,pubSubDomain:c,msgPayLoad:b,jmsHeaderProperties:f},e)}return d},sendJmsMap:function(f,a,b,e,d){var c=this.checkConnected();if(0==c.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.SEND_MAP,connectionFactoryName:f,destinationName:a,pubSubDomain:b,msgPayLoad:e},d)}return c},sendJmsMapMessage:function(g,a,b,f,e,d){var c=this.checkConnected();if(0==c.code){this.sendToken({ns:jws.JMSPlugIn.NS,type:jws.JMSPlugIn.SEND_MAP_MESSAGE,connectionFactoryName:g,destinationName:a,pubSubDomain:b,msgPayLoad:f,jmsHeaderProperties:e},d)}return c},processToken:function(a){if(a.ns==jws.JMSPlugIn.NS){if("event"==a.type){if("handleJmsText"==a.name){if(this.OnHandleJmsText){this.OnHandleJmsText(a)}}else{if("handleJmsTextMessage"==a.name){if(this.OnHandleJmsTextMessage){this.OnHandleJmsTextMessage(a)}}else{if("handleJmsMap"==a.name){if(this.OnHandleJmsMap){this.OnHandleJmsMap(a)}}else{if("handleJmsMapMessage"==a.name){if(this.OnHandleJmsMapMessage){this.OnHandleJmsMapMessage(a)}}}}}}}},setHandleMessageCallbacks:function(a){if(!a){a={}}if(a.OnHandleJmsText!==undefined){this.OnHandleJmsText=a.OnHandleJmsText}if(a.OnHandleJmsTextMessage!==undefined){this.OnHandleJmsTextMessage=a.OnHandleJmsTextMessage}if(a.OnHandleJmsMap!==undefined){this.OnHandleJmsMap=a.OnHandleJmsMap}if(a.OnHandleJmsMapMessage!==undefined){this.OnHandleJmsMapMessage=a.OnHandleJmsMapMessage}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.JMSPlugIn);jws.LoggingPlugIn={NS:jws.NS_BASE+".plugins.logging",DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",FATAL:"fatal",processToken:function(a){if(a.ns==jws.LoggingPlugIn.NS){if("log"==a.reqType){if(this.OnLogged){this.OnLogged(a)}}}},loggingLog:function(e,b,f,d){var c=this.checkConnected();if(0==c.code){var a={ns:jws.LoggingPlugIn.NS,type:"log",level:e,info:b,message:f};this.sendToken(a,d)}return c},loggingEvent:function(g,e,a){var f=this.checkConnected();if(0==f.code){var j=null;var d=null;if(a){if(a.primaryKey){d=a.primaryKey}if(a.sequence){j=a.sequence}}var c=[];var h=[];for(var i in e){c.push(i);h.push(e[i])}var b={ns:jws.LoggingPlugIn.NS,type:"logEvent",table:g,fields:c,values:h};if(d&&j){b.primaryKey=d;b.sequence=j}this.sendToken(b,a)}return f},loggingGetEvents:function(d,f){var e=this.checkConnected();if(0==e.code){var c=null;var a=null;var g=null;if(f){if(f.primaryKey){c=f.primaryKey}if(f.fromKey){a=f.fromKey}if(f.toKey){g=f.toKey}}var b={ns:jws.LoggingPlugIn.NS,type:"getEvents",table:d,primaryKey:c,fromKey:a,toKey:g};this.sendToken(b,f)}return e},loggingSubscribe:function(a,b){},loggingUnsubscribe:function(a,b){},setLoggingCallbacks:function(a){if(!a){a={}}if(a.OnLogged!==undefined){this.OnLogged=a.OnLogged}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.LoggingPlugIn);jws.MailPlugIn={NS:jws.NS_BASE+".plugins.mail",HTML_MAIL:true,TEXT_MAIL:false,processToken:function(a){if(a.ns==jws.MailPlugIn.NS){if("sendMail"==a.reqType){if(this.OnMailSent){this.OnMailSent(a)}}}},sendMail:function(d,c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.MailPlugIn.NS,type:"sendMail",id:d};this.sendToken(a,c)}return b},createMail:function(g,a,j,i,h,d,e,b){var f=this.checkConnected();if(0==f.code){var c={ns:jws.MailPlugIn.NS,type:"createMail",from:g,to:a,cc:j,bcc:i,subject:h,body:d,isHTML:e};this.sendToken(c,b)}return f},dropMail:function(d,c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.MailPlugIn.NS,type:"dropMail",id:d};this.sendToken(a,c)}return b},addAttachment:function(f,k,g,b){var h=this.checkConnected();if(0==h.code){var i="base64";var c=false;var j=jws.SCOPE_PRIVATE;var a=null;var e=null;if(b){if(b.scope!=undefined){j=b.scope}if(b.encoding!=undefined){i=b.encoding}if(b.suppressEncoder!=undefined){c=b.suppressEncoder}if(b.volumeSize!=undefined){a=b.volumeSize}if(b.archiveName!=undefined){e=b.archiveName}}if(!c){if(i=="base64"){g=Base64.encode(g)}}var d={ns:jws.MailPlugIn.NS,type:"addAttachment",encoding:i,id:f,data:g,filename:k};if(a){d.volumeSize=a}if(e){d.archiveName=e}this.sendToken(d,b)}return h},removeAttachment:function(b,a){},getMail:function(b,a){},moveMail:function(b,a){},setMailCallbacks:function(a){if(!a){a={}}if(a.OnMailSent!==undefined){this.OnMailSent=a.OnMailSent}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.MailPlugIn);jws.ReportingPlugIn={NS:jws.NS_BASE+".plugins.reporting",processToken:function(a){if(a.ns==jws.ReportingPlugIn.NS){if("createReport"==a.reqType){if(this.OnReport){this.OnReport(a)}}else{if("getReports"==a.reqType){if(this.OnReports){this.OnReports(a)}}else{if("getReportParams"==a.reqType){if(this.OnReportParams){this.OnReportParams(a)}}}}}},reportingCreateReport:function(d,f,e){var c=this.checkConnected();if(0==c.code){var a="pdf";if(e){if(e.outputType){a=e.outputType}}var b={ns:jws.ReportingPlugIn.NS,type:"createReport",reportId:d,outputType:a,params:f};this.sendToken(b,e)}return c},reportingGetReports:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.ReportingPlugIn.NS,type:"getReports"};this.sendToken(a,c)}return b},reportingGetReportParams:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.ReportingPlugIn.NS,type:"getReportParams",reportId:c};this.sendToken(a,d)}return b},setReportingCallbacks:function(a){if(!a){a={}}if(a.OnReportAvail!==undefined){this.OnReportAvail=a.OnReportAvail}if(a.OnReports!==undefined){this.OnReports=a.OnReports}if(a.OnReportParams!==undefined){this.OnReportParams=a.OnReportParams}},displayPDF:function(b,e,c,a){if(jws.isIExplorer()){var d='<object classid="clsid:CA8A9780-280D-11CF-A24D-444553540000" width="'+c+'" height="'+a+'" ><param name="src" value="'+encodeURI(e)+'"><embed src="'+encodeURI(e)+'" width="'+c+'" height="'+a+'" ><noembed> Your browser does not support embedded PDF files. </noembed></embed></object>';if(b.pdf){b.removeChild(b.pdf)}b.pdf=null;b.innerHTML=d;b.pdf=b.firstChild}else{var g=((b.pdf===null)||(b.pdf===undefined)||(jws.isFirefox()&&jws.getBrowserVersion()<3));var f=(g?document.createElement("embed"):b.pdf);f.setAttribute("id",b.id+".embPdf");f.setAttribute("style","position:relative;padding:0px;margin:0px;border:0px;left:0px;top:0px;width:"+c+"px;height:"+a+"px");f.setAttribute("type","application/pdf");f.setAttribute("width",'"'+c+'"');f.setAttribute("height",'"'+a+'"');f.setAttribute("src",e);if(g){if(b.pdf){b.removeChild(b.pdf)}}b.pdf=f;b.appendChild(b.pdf)}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.ReportingPlugIn);jws.RPCClientPlugIn={grantedProcs:[],spawnThreadDefault:false,NS:jws.NS_BASE+".plugins.rpc",setSpawnThreadDefault:function(a){this.spawnThreadDefault=a},addGrantedProcedure:function(a){jws.RPCClientPlugIn.grantedProcs[jws.RPCClientPlugIn.grantedProcs.length]=a},removeGrantedProcedure:function(b){var a=jws.RPCClientPlugIn.grantedProcs.indexOf(b);if(a>=0){jws.RPCClientPlugIn.grantedProcs.splice(a,1)}},processToken:function(a){if(a.ns==jws.RPCClientPlugIn.NS){if(a.type=="rrpc"){this.onRRPC(a)}}},rpc:function(c,a,e,d){if(e!=null&&!(e instanceof Array)){e=[e]}d=this.setDefaultOption(d);var b=this.createDefaultResult();if(this.isConnected()){this.sendToken({ns:jws.RPCClientPlugIn.NS,type:"rpc",classname:c,method:a,args:e},d)}else{b.code=-1;b.localeKey="jws.jsc.res.notConnected";b.msg="Not connected."}return b},setDefaultOption:function(a){if(a===undefined){a={}}if(a.spawnThread===undefined){a.spawnThread=this.spawnThreadDefault}return a},rrpc:function(d,c,a,f,e){if(f!=null&&!(f instanceof Array)){f=[f]}e=this.setDefaultOption(e);var b=this.createDefaultResult();if(this.isConnected()){this.sendToken({ns:jws.RPCClientPlugIn.NS,type:"rrpc",targetId:d,classname:c,method:a,args:f},e)}else{b.code=-1;b.localeKey="jws.jsc.res.notConnected";b.msg="Not connected."}return b},onRRPC:function(i){var a=i.classname;var h=i.method;var f=i.args;var k=a+"."+h;if(jws.RPCClientPlugIn.grantedProcs.indexOf(k)>=0){var l=a.split(".");var b=l.length;var c=window[l[0]];for(var d=1;d<b;d++){c=c[l[d]]}var e;try{e=c[h].apply(null,f)}catch(g){e=g+"\nProbably a typo error (method called="+h+") or wrong number of arguments (args: "+JSON.stringify(f)+")"}}else{e=+"\nAcces not granted to the="+h}this.sendToken({type:"send",targetId:i.sourceId,result:e,reqType:"rrpc",code:0},null)}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.RPCClientPlugIn);jws.SamplesPlugIn={NS:jws.NS_BASE+".plugins.samples",processToken:function(a){if(a.ns==jws.SamplesPlugIn.NS){if("requestServerTime"==a.reqType){if(this.OnSamplesServerTime){this.OnSamplesServerTime(a)}}}},requestServerTime:function(c){var b=this.createDefaultResult();if(this.isConnected()){var a={ns:jws.SamplesPlugIn.NS,type:"requestServerTime"};this.sendToken(a,c)}else{b.code=-1;b.localeKey="jws.jsc.res.notConnected";b.msg="Not connected."}return b},setSamplesCallbacks:function(a){if(!a){a={}}if(a.OnSamplesServerTime!==undefined){this.OnSamplesServerTime=a.OnSamplesServerTime}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.SamplesPlugIn);jws.SharedObjectsPlugIn={NS:jws.NS_BASE+".plugins.sharedObjs",DATA_TYPES:["number","string","boolean","object","set","list","map","table"],fObjects:{},processToken:function(a){if(a.ns==jws.SharedObjectsPlugIn.NS){if(a.name=="created"){if(this.OnSharedObjectCreated){this.OnSharedObjectCreated(a)}}else{if(a.name=="destroyed"){if(this.OnSharedObjectDestroyed){this.OnSharedObjectDestroyed(a)}}else{if(a.name=="updated"){if(this.OnSharedObjectUpdated){this.OnSharedObjectUpdated(a)}}else{if(a.name=="init"){if(this.OnSharedObjectsInit){var b=JSON.parse(a.value);this.OnSharedObjectsInit(a,b)}}}}}}},createSharedObject:function(f,b,d,e){var c=this.createDefaultResult();if(this.isConnected()){var a={ns:jws.SharedObjectsPlugIn.NS,type:"create",id:f,datatype:b,value:d};this.sendToken(a,e);if(this.OnSharedObjectCreated){this.OnSharedObjectCreated(a)}}else{c.code=-1;c.localeKey="jws.jsc.res.notConnected";c.msg="Not connected."}return c},destroySharedObject:function(e,b,d){var c=this.createDefaultResult();if(this.isConnected()){var a={ns:jws.SharedObjectsPlugIn.NS,type:"destroy",id:e,datatype:b};this.sendToken(a,d);if(this.OnSharedObjectDestroyed){this.OnSharedObjectDestroyed(a)}}else{c.code=-1;c.localeKey="jws.jsc.res.notConnected";c.msg="Not connected."}return c},getSharedObject:function(e,b,d){var c=this.createDefaultResult();if(this.isConnected()){var a={ns:jws.SharedObjectsPlugIn.NS,type:"get",id:e,datatype:b};this.sendToken(a,d)}else{c.code=-1;c.localeKey="jws.jsc.res.notConnected";c.msg="Not connected."}return c},updateSharedObject:function(f,b,d,e){var c=this.createDefaultResult();if(this.isConnected()){var a={ns:jws.SharedObjectsPlugIn.NS,type:"update",id:f,datatype:b,value:d};this.sendToken(a,e);if(this.OnSharedObjectUpdated){this.OnSharedObjectUpdated(a)}}else{c.code=-1;c.localeKey="jws.jsc.res.notConnected";c.msg="Not connected."}return c},setSharedObjectsCallbacks:function(a){if(!a){a={}}if(a.OnSharedObjectCreated!==undefined){this.OnSharedObjectCreated=a.OnSharedObjectCreated}if(a.OnSharedObjectDestroyed!==undefined){this.OnSharedObjectDestroyed=a.OnSharedObjectDestroyed}if(a.OnSharedObjectUpdated!==undefined){this.OnSharedObjectUpdated=a.OnSharedObjectUpdated}if(a.OnSharedObjectsInit!==undefined){this.OnSharedObjectsInit=a.OnSharedObjectsInit}},initSharedObjects:function(c){var b=this.createDefaultResult();if(this.isConnected()){var a={ns:jws.SharedObjectsPlugIn.NS,type:"init"};this.sendToken(a,c)}else{b.code=-1;b.localeKey="jws.jsc.res.notConnected";b.msg="Not connected."}return b}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.SharedObjectsPlugIn);jws.StreamingPlugIn={NS:jws.NS_BASE+".plugins.streaming",registerStream:function(c,b){var a=this.createDefaultResult();if(this.isConnected()){this.sendToken({ns:jws.StreamingPlugIn.NS,type:"register",stream:c},b)}else{a.code=-1;a.localeKey="jws.jsc.res.notConnected";a.msg="Not connected."}return a},unregisterStream:function(c,b){var a=this.createDefaultResult();if(this.isConnected()){this.sendToken({ns:jws.StreamingPlugIn.NS,type:"unregister",stream:c},b)}else{a.code=-1;a.localeKey="jws.jsc.res.notConnected";a.msg="Not connected."}return a}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.StreamingPlugIn);jws.TestPlugIn={NS:jws.NS_BASE+".plugins.test",processToken:function(a){if(a.ns==jws.TestPlugIn.NS){if("event"==a.type){if("testStarted"==a.name&&this.OnTestStarted){this.OnTestStarted(a)}else{if("testStopped"==a.name&&this.OnTestStopped){this.OnTestStopped(a)}else{if("startTest"==a.name&&this.OnStartTest){this.OnStartTest(a)}}}}}},testTimeout:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.TestPlugIn.NS,type:"delay",delay:a};this.sendToken(b,d)}return c},testS2CPerformance:function(b,e,d){var c=this.checkConnected();if(0==c.code){var a={ns:jws.TestPlugIn.NS,type:"testS2CPerformance",count:b,message:e};this.sendToken(a,d)}return c},execTests:function(){setTimeout(function(){var a=new jasmine.TrivialReporter();jasmine.getEnv().addReporter(a);jasmine.getEnv().execute()},1000)},setTestCallbacks:function(a){if(!a){a={}}if(a.OnStartTest!==undefined){this.OnStartTest=a.OnStartTest}if(a.OnTestStarted!==undefined){this.OnTestStarted=a.OnTestStarted}if(a.OnTestStopped!==undefined){this.OnTestStopped=a.OnTestStopped}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.TestPlugIn);jws.StopWatchPlugIn={NS:jws.NS_BASE+".plugins.stopwatch",mLog:{},startWatch:function(c,b){var a={spec:b,started:new Date().getTime()};this.mLog[c]=a;return a},stopWatch:function(b){var a=this.mLog[b];if(a){a.stopped=new Date().getTime();a.millis=a.stopped-a.started;return a}else{return null}},logWatch:function(d,c,b){var a={spec:c,millis:b};this.mLog[d]=a;return a},resetWatches:function(){this.mLog={}},printWatches:function(){for(var c in this.mLog){var a=this.mLog[c];var b=a.spec+" ("+c+"): "+a.millis+"ms";if(window.console){console.log(b)}else{document.write(b+"<br>")}}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.StopWatchPlugIn);jws.TwitterPlugIn={NS:jws.NS_BASE+".plugins.twitter",processToken:function(a){if(a.ns==jws.TwitterPlugIn.NS){if("getTimeline"==a.reqType){if(this.OnGotTwitterTimeline){this.OnGotTwitterTimeline(a)}}else{if("requestAccessToken"==a.reqType){if(this.OnTwitterAccessToken){this.OnTwitterAccessToken(a)}}else{if("event"==a.type){if("status"==a.name&&this.OnTwitterStatus){this.OnTwitterStatus(a)}}}}}},tweet:function(d,c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"tweet",message:d};this.sendToken(a,c)}return b},twitterRequestAccessToken:function(d,c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"requestAccessToken",callbackURL:d};this.sendToken(a,c)}return b},twitterSetVerifier:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.TwitterPlugIn.NS,type:"setVerifier",verifier:a};this.sendToken(b,d)}return c},twitterLogin:function(d,c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"login",callbackURL:d};this.sendToken(a,c)}return b},twitterLogout:function(a,c,e){var d=this.checkConnected();if(0==d.code){var b={ns:jws.TwitterPlugIn.NS,type:"logout"};this.sendToken(b,e)}return d},twitterTimeline:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.TwitterPlugIn.NS,type:"getTimeline",username:a};this.sendToken(b,d)}return c},twitterQuery:function(c,d){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"query",query:c};this.sendToken(a,d)}return b},twitterTrends:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"getTrends"};this.sendToken(a,c)}return b},twitterStatistics:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"getStatistics"};this.sendToken(a,c)}return b},twitterPublicTimeline:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.TwitterPlugIn.NS,type:"getPublicTimeline"};this.sendToken(a,c)}return b},twitterSetStream:function(e,b,d){var c=this.checkConnected();if(0==c.code){var a={ns:jws.TwitterPlugIn.NS,type:"setStream",keywords:b,followers:e};this.sendToken(a,d)}return c},twitterUserData:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.TwitterPlugIn.NS,type:"getUserData",username:a};this.sendToken(b,d)}return c},setTwitterCallbacks:function(a){if(!a){a={}}if(a.OnGotTwitterTimeline!==undefined){this.OnGotTwitterTimeline=a.OnGotTwitterTimeline}if(a.OnTwitterStatus!==undefined){this.OnTwitterStatus=a.OnTwitterStatus}if(a.OnTwitterAccessToken!==undefined){this.OnTwitterAccessToken=a.OnTwitterAccessToken}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.TwitterPlugIn);jws.XMPPPlugIn={NS:jws.NS_BASE+".plugins.xmpp",MODE_AVAILABLE:"available",MODE_AWAY:"away",MODE_CHAT:"chat",MODE_DND:"dnd",MODE_XA:"xa",TYPE_AVAILABLE:"available",TYPE_UNAVAILABLE:"unavailable",TYPE_SUBSCRIBE:"subscribe",TYPE_SUBSCRIBED:"subscribed",TYPE_UNSUBSCRIBE:"unsubscribe",TYPE_UNSUBSCRIBED:"unsubscribed",TYPE_ERROR:"error",processToken:function(a){if(a.ns==jws.XMPPPlugIn.NS){if("event"==a.type){if("chatMessage"==a.name){if(this.OnXMPPChatMessage){this.OnXMPPChatMessage(a)}}}else{if("getRoster"==a.reqType){if(this.OnXMPPRoster){this.OnXMPPRoster(a)}}}}},xmppConnect:function(a,g,d,c,f){var e=this.checkConnected();if(0==e.code){var b={ns:jws.XMPPPlugIn.NS,type:"connect",host:a,port:g,domain:d,useSSL:c};this.sendToken(b,f)}return e},xmppDisconnect:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.XMPPPlugIn.NS,type:"disconnect"};this.sendToken(a,c)}return b},xmppLogin:function(a,c,e){var d=this.checkConnected();if(0==d.code){var b={ns:jws.XMPPPlugIn.NS,type:"login",username:a,password:c};this.sendToken(b,e)}return d},xmppLogout:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.XMPPPlugIn.NS,type:"logout"};this.sendToken(a,c)}return b},xmppRoster:function(c){var b=this.checkConnected();if(0==b.code){var a={ns:jws.XMPPPlugIn.NS,type:"getRoster"};this.sendToken(a,c)}return b},xmppSetPresence:function(d,a,g,c,f){var e=this.checkConnected();if(0==e.code){var b={ns:jws.XMPPPlugIn.NS,type:"setPresence",pmode:d,ptype:a,ppriority:c,pstatus:g};this.sendToken(b,f)}return e},xmppOpenChat:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.XMPPPlugIn.NS,type:"openChat",userId:a};this.sendToken(b,d)}return c},xmppSendChat:function(a,e,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.XMPPPlugIn.NS,type:"sendChat",userId:a,message:e};this.sendToken(b,d)}return c},xmppCloseChat:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.XMPPPlugIn.NS,userId:a,type:"closeChat"};this.sendToken(b,d)}return c},xmpp:function(a,d){var c=this.checkConnected();if(0==c.code){var b={ns:jws.XMPPPlugIn.NS,userId:a,type:"closeChat"};this.sendToken(b,d)}return c},setXMPPCallbacks:function(a){if(!a){a={}}if(a.OnXMPPChatMessage!==undefined){this.OnXMPPChatMessage=a.OnXMPPChatMessage}if(a.OnXMPPRoster!==undefined){this.OnXMPPRoster=a.OnXMPPRoster}}};jws.oop.addPlugIn(jws.jWebSocketTokenClient,jws.XMPPPlugIn);onmessage=function(aEvent){var lMethod;eval("lMethod="+aEvent.data.method);postMessage(lMethod(aEvent.data.args))};